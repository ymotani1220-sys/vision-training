<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° ã‚»ãƒƒãƒˆ</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.4s;
}

/* å…±é€š */
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none;}
button{font-size:20px;padding:14px 26px;margin:10px}

/* ãƒˆãƒƒãƒ— */
#top h1{font-size:22px}

/* ===== å›è»¢åˆ¤æ–­ ===== */
#spinGame{position:relative;width:320px;height:320px}
#spinInfo{position:absolute;top:-90px;width:100%;text-align:center}
#result{position:absolute;top:-35px;left:50%;transform:translateX(-50%);
  font-size:34px;font-weight:bold;height:40px;text-shadow:0 0 6px #000}
#center{
  position:absolute;top:50%;left:50%;
  width:80px;height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;background:#fff;
  display:flex;justify-content:center;align-items:center
}
#arrow{font-size:46px;font-weight:900;color:#f33;text-shadow:0 0 8px #000}
.spin-btn{
  position:absolute;width:50px;height:50px;
  border-radius:50%;background:#c00;border:none
}
.spin-btn::after{
  content:'';position:absolute;bottom:-18px;left:50%;
  width:12px;height:22px;background:#caa;
  transform:translateX(-50%);
  border-radius:0 0 6px 6px
}
.spin-btn.active{background:#0f9}

/* ===== çµ‚äº† ===== */
#end h2{margin-bottom:10px}
</style>
</head>

<body>

<!-- ===== ãƒˆãƒƒãƒ— ===== -->
<div id="top" class="screen">
  <h1>ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startSpin()">å›è»¢åˆ¤æ–­</button>
</div>

<!-- ===== å›è»¢åˆ¤æ–­ ===== -->
<div id="spinScreen" class="screen hidden">
  <div id="spinGame">

    <div id="spinInfo">
      Lv <span id="level">1</span>
      ğŸ”¥ <span id="combo">0</span>
      â­ <span id="score">1.0</span>
      â± <span id="timeSpin">60</span>
    </div>

    <div id="result"></div>

    <div id="center">
      <div id="arrow">â†‘</div>
    </div>
  </div>
</div>

<!-- ===== çµ‚äº† ===== -->
<div id="end" class="screen hidden">
  <h2>ğŸ‰ çµæœ</h2>
  <p id="finalScore"></p>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== èƒŒæ™¯è‰² ===== */
const bgColors=[
  '#111','#0b1a2a','#102a1c',
  '#2a1c10','#2a1010','#1a102a','#2a002a'
];

/* ===== å›è»¢åˆ¤æ–­ ===== */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=120, center=160;
const showTimes=[1200,1000,850,700,600,500,400];

const arrow=document.getElementById('arrow');
const resultEl=document.getElementById('result');
const levelEl=document.getElementById('level');
const comboEl=document.getElementById('combo');
const scoreEl=document.getElementById('score');

let rackets=[],correct=0,answered=false,timer=null;
let level=1,combo=0;
let timeLeft=60,gameTimer=null,gameEnd=false;

/* ãƒ©ã‚±ãƒƒãƒˆç”Ÿæˆ */
anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-25+'px';
  b.style.top =center+radius*Math.sin(a)-25+'px';
  b.onclick=()=>answerSpin(i);
  rackets.push(b);
  document.getElementById('spinGame').appendChild(b);
});

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function startSpin(){
  show('spinScreen');
  level=1; combo=0; timeLeft=60; gameEnd=false;
  updateUI(); updateBackground();
  document.getElementById('timeSpin').textContent=timeLeft;

  gameTimer=setInterval(()=>{
    timeLeft--;
    document.getElementById('timeSpin').textContent=timeLeft;
    if(timeLeft<=0) endSpin();
  },1000);

  nextSpin();
}

function nextSpin(){
  if(gameEnd) return;
  clearTimeout(timer);
  answered=false;
  resultEl.textContent='';
  rackets.forEach(r=>r.classList.remove('active'));

  correct=Math.floor(Math.random()*8);
  arrow.style.transform=`rotate(${anglesDeg[correct]+90}deg)`;
  rackets[correct].classList.add('active');

  timer=setTimeout(()=>judgeSpin(false), showTimes[level-1]);
}

function answerSpin(i){
  if(answered||gameEnd) return;
  judgeSpin(i===correct);
}

function judgeSpin(ok){
  answered=true;
  clearTimeout(timer);
  rackets.forEach(r=>r.classList.remove('active'));

  if(ok){
    resultEl.textContent='ã€‡';
    resultEl.style.color='#0f9';
    combo++;
    if(combo>=5 && level<7){
      level++; combo=0;
      updateBackground();
    }
  }else{
    resultEl.textContent='âœ–';
    resultEl.style.color='#f00';
    combo=0;
  }

  updateUI();
  setTimeout(()=>{
    resultEl.textContent='';
    nextSpin();
  },600);
}

function updateUI(){
  levelEl.textContent=level;
  comboEl.textContent=combo;
  scoreEl.textContent=`${level}.${combo}`;
}

function updateBackground(){
  document.body.style.background=bgColors[level-1];
}

function endSpin(){
  gameEnd=true;
  clearInterval(gameTimer);
  clearTimeout(timer);
  show('end');
  document.getElementById('finalScore').textContent=
    `ã‚¹ã‚³ã‚¢ï¼š${scoreEl.textContent}`;
}

function backTop(){
  document.body.style.background='#111';
  show('top');
}
</script>

</body>
</html>
