<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.4s;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none}
button{font-size:20px;padding:14px 26px;margin:10px}

/* ===== ãƒˆãƒƒãƒ— ===== */
#top h1{font-size:22px}

/* ===== å›è»¢åˆ¤æ–­ ===== */
#spinGame{position:relative;width:320px;height:320px}
#spinInfo{position:absolute;top:-90px;width:100%;text-align:center}
#result{position:absolute;top:-35px;left:50%;transform:translateX(-50%);
  font-size:34px;font-weight:bold;height:40px}
#center{
  position:absolute;top:50%;left:50%;
  width:80px;height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;background:#fff;
  display:flex;justify-content:center;align-items:center
}
#arrow{font-size:46px;font-weight:900;color:#f33}
.spin-btn{
  position:absolute;width:50px;height:50px;
  border-radius:50%;background:#c00;border:none
}
.spin-btn.active{background:#0f9}

/* ===== ç¬é–“åˆ¤æ–­ ===== */
#flashGame .arrow{font-size:100px;margin:30px}
#feedback{font-size:40px;height:50px}
</style>
</head>

<body>

<!-- ===== ãƒˆãƒƒãƒ— ===== -->
<div id="top" class="screen">
  <h1>ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startSpin()">å›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
  <button onclick="startFlash()">ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
</div>

<!-- ===== å›è»¢åˆ¤æ–­ ===== -->
<div id="spinScreen" class="screen hidden">
  <div id="spinGame">
    <div id="spinInfo">
      Lv <span id="level">1</span>
      ğŸ”¥ <span id="combo">0</span>
      â­ <span id="score">1.0</span>
      â± <span id="timeSpin">60</span>
    </div>
    <div id="result"></div>
    <div id="center"><div id="arrow">â†‘</div></div>
  </div>
</div>

<!-- ===== ç¬é–“åˆ¤æ–­ ===== -->
<div id="flashScreen" class="screen hidden">
  <div id="flashGame">
    â± <span id="timeFlash">60</span><br>
    Lv <span id="flashLevel">1</span> ğŸ”¥ <span id="flashCombo">0</span><br>
    â­ <span id="flashScore">1.0</span>

    <div id="flashArrow" class="arrow"></div>
    <div id="feedback"></div>

    <button onclick="answerFlash('left')">â†</button>
    <button onclick="answerFlash('up')">â†‘</button>
    <button onclick="answerFlash('right')">â†’</button>
  </div>
</div>

<!-- ===== çµ‚äº† ===== -->
<div id="end" class="screen hidden">
  <h2>ğŸ‰ çµ‚äº†</h2>
  <p id="finalScore"></p>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== å…±é€š ===== */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* ================= å›è»¢åˆ¤æ–­ ================= */
const bgColors=['#111','#0b1a2a','#102a1c','#2a1c10','#2a1010','#1a102a','#2a002a'];
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=120, center=160;
const showTimes=[1200,1000,850,700,600,500,400];

let rackets=[],correct=0,answered=false,timer=null;
let level=1,combo=0,timeLeft=60,spinTimer=null,spinEnd=false;

anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-25+'px';
  b.style.top =center+radius*Math.sin(a)-25+'px';
  b.onclick=()=>judgeSpin(i===correct);
  rackets.push(b);
  document.getElementById('spinGame').appendChild(b);
});

function startSpin(){
  show('spinScreen');
  level=1;combo=0;timeLeft=60;spinEnd=false;
  updateSpinUI();updateBg();
  spinTimer=setInterval(()=>{
    timeLeft--;timeSpin.textContent=timeLeft;
    if(timeLeft<=0) endSpin();
  },1000);
  nextSpin();
}

function nextSpin(){
  if(spinEnd)return;
  answered=false;
  result.textContent='';
  rackets.forEach(r=>r.classList.remove('active'));
  correct=Math.floor(Math.random()*8);
  arrow.style.transform=`rotate(${anglesDeg[correct]+90}deg)`;
  rackets[correct].classList.add('active');
  timer=setTimeout(()=>judgeSpin(false),showTimes[level-1]);
}

function judgeSpin(ok){
  if(answered||spinEnd)return;
  answered=true;clearTimeout(timer);
  rackets.forEach(r=>r.classList.remove('active'));
  if(ok){
    result.textContent='ã€‡';result.style.color='#0f9';combo++;
    if(combo>=5&&level<7){level++;combo=0;updateBg();}
  }else{
    result.textContent='âœ–';result.style.color='#f00';combo=0;
  }
  updateSpinUI();
  setTimeout(nextSpin,600);
}

function updateSpinUI(){
  level.textContent=level;
  combo.textContent=combo;
  score.textContent=`${level}.${combo}`;
}
function updateBg(){document.body.style.background=bgColors[level-1]}
function endSpin(){
  spinEnd=true;clearInterval(spinTimer);
  finalScore.textContent=`å›è»¢åˆ¤æ–­ ã‚¹ã‚³ã‚¢ï¼š${score.textContent}`;
  show('end');
}

/* ================= ç¬é–“åˆ¤æ–­ ================= */
const arrows=['left','up','right'];
const icons={left:'â†',up:'â†‘',right:'â†’'};
let flashLevel=1,flashCombo=0,flashTime=60,flashTimer=null,current='';

function startFlash(){
  show('flashScreen');
  flashLevel=1;flashCombo=0;flashTime=60;
  timeFlash.textContent=flashTime;
  flashTimer=setInterval(()=>{
    flashTime--;timeFlash.textContent=flashTime;
    if(flashTime<=0) endFlash();
  },1000);
  nextFlash();
}

function nextFlash(){
  current=arrows[Math.floor(Math.random()*3)];
  flashArrow.textContent=icons[current];
}

function answerFlash(a){
  if(a===current){feedback.textContent='ã€‡';flashCombo++;}
  else{feedback.textContent='âœ–';flashCombo=0;}
  flashCombo.textContent=flashCombo;
  setTimeout(()=>{feedback.textContent='';nextFlash();},300);
}

function endFlash(){
  clearInterval(flashTimer);
  finalScore.textContent=`ç¬é–“åˆ¤æ–­ ã‚¹ã‚³ã‚¢ï¼š${flashLevel}.${flashCombo}`;
  show('end');
}

function backTop(){
  document.body.style.background='#111';
  show('top');
}
</script>

</body>
</html>
