<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å“çƒ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #eef7ff;
    user-select: none;
  }
  h1 { font-size: 26px; }
  button {
    font-size: 20px;
    padding: 12px 20px;
    margin: 6px;
  }
  #target {
    font-size: 60px;
    margin: 25px;
    display: none;
  }
  #result {
    font-size: 22px;
    margin-top: 10px;
  }
  #combo {
    font-size: 24px;
    color: red;
    margin-top: 5px;
  }
</style>
</head>
<body>

<h1>ğŸ“ å“çƒ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>

<p>ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ</p>

<button onclick="setLevel(800,2)">Lv1</button>
<button onclick="setLevel(600,2)">Lv2</button>
<button onclick="setLevel(400,2)">Lv3</button>
<button onclick="setLevel(250,3)">Lv4ï¼ˆä¸Šç´šï¼‰</button>

<br><br>
<button onclick="startGame()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

<div id="target"></div>

<div>
  <button onclick="judge('ãƒ•ã‚©ã‚¢')">ãƒ•ã‚©ã‚¢</button>
  <button onclick="judge('ãƒŸãƒ‰ãƒ«')">ãƒŸãƒ‰ãƒ«</button>
  <button onclick="judge('ãƒãƒƒã‚¯')">ãƒãƒƒã‚¯</button>
</div>

<div id="result"></div>
<div id="combo"></div>

<script>
let displayTime = 800;
let choices = ["ãƒ•ã‚©ã‚¢","ãƒãƒƒã‚¯"];
let answer = "";
let visible = false;
let combo = 0;

// Audio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(freq, duration) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = freq;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(
    0.0001, audioCtx.currentTime + duration
  );
  osc.stop(audioCtx.currentTime + duration);
}

function setLevel(time, mode) {
  displayTime = time;
  choices = (mode === 2)
    ? ["ãƒ•ã‚©ã‚¢","ãƒãƒƒã‚¯"]
    : ["ãƒ•ã‚©ã‚¢","ãƒŸãƒ‰ãƒ«","ãƒãƒƒã‚¯"];

  document.getElementById("result").textContent =
    "ãƒ¬ãƒ™ãƒ«è¨­å®šï¼š" + choices.join(" / ");
}

function startGame() {
  audioCtx.resume();
  visible = false;
  document.getElementById("target").style.display = "none";
  document.getElementById("result").textContent = "";
  document.getElementById("combo").textContent = "";

  setTimeout(() => {
    answer = choices[Math.floor(Math.random() * choices.length)];
    const target = document.getElementById("target");
    target.textContent = answer;
    target.style.display = "block";
    visible = true;

    setTimeout(() => {
      if (!visible) return;
      visible = false;
      combo = 0;
      target.style.display = "none";
      playSound(150, 0.3);
      document.getElementById("result").textContent = "âŒ é…ã„ï¼";
    }, displayTime);

  }, Math.random() * 1000 + 500);
}

function judge(select) {
  if (!visible) return;

  visible = false;
  document.getElementById("target").style.display = "none";

  if (select === answer) {
    combo++;
    playSound(600, 0.15);
    document.getElementById("result").textContent = "â­• æ­£è§£ï¼";

    if (combo >= 3) {
      playSound(900, 0.2);
      document.getElementById("combo").textContent =
        "ğŸ”¥ " + combo + " ã‚³ãƒ³ãƒœï¼";
    } else {
      document.getElementById("combo").textContent =
        combo + " ã‚³ãƒ³ãƒœ";
    }
  } else {
    combo = 0;
    playSound(200, 0.3);
    document.getElementById("result").textContent = "âŒ ãƒŸã‚¹";
    document.getElementById("combo").textContent = "";
  }
}
</script>

</body>
</html>
