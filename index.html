<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒãƒˆ</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.4s;
}

/* ===== å…±é€š ===== */
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{ display:none; }

button{
  font-size:20px;
  padding:14px 28px;
  border:none;
  border-radius:14px;
  cursor:pointer;
}

/* ===== ãƒˆãƒƒãƒ— ===== */
#top h1{ font-size:24px; margin-bottom:30px; }
.menu button{ width:260px; margin:10px 0; }

/* ===== ç¬é–“åˆ¤æ–­ ===== */
.arrow{ font-size:100px; margin:30px 0; }
#feedback{ font-size:40px; height:50px; }
.overlay{ background:rgba(0,0,0,0.6); min-height:100vh; width:100%; text-align:center; }
#instantRanking{ text-align:left; max-width:320px; margin:auto; }

/* ===== å›è»¢åˆ¤æ–­ ===== */
#game{ position:relative; width:320px; height:320px; }
#info{ position:absolute; top:-90px; width:100%; text-align:center; font-size:18px; }
#result{ position:absolute; top:-35px; left:50%; transform:translateX(-50%); font-size:34px; height:40px; }
#center{
  position:absolute; top:50%; left:50%;
  width:80px; height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%; background:#fff;
  display:flex; justify-content:center; align-items:center;
}
#arrowSpin{ font-size:46px; font-weight:900; color:#f33; }

.spin-btn{
  position:absolute;
  width:50px; height:50px;
  border-radius:50%; background:#c00; border:none;
}
.spin-btn::after{
  content:'';
  position:absolute;
  bottom:-18px; left:50%;
  width:12px; height:22px;
  background:#caa; transform:translateX(-50%);
}
.spin-btn.active{ background:#0f9; }
</style>
</head>

<body>

<!-- ===== ãƒˆãƒƒãƒ— ===== -->
<div id="top" class="screen">
  <h1>ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <div class="menu">
    <button onclick="startInstant()">ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
    <button onclick="startSpin()">å›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
  </div>
</div>

<!-- ===== ç¬é–“åˆ¤æ–­ ===== -->
<div id="instantScreen" class="screen hidden">
  <div id="instantStart" class="overlay">
    <h1>ğŸ“ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
    <input id="playerName" placeholder="åå‰">
    <br><br>
    <button onclick="instantStartGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

  <div id="instantGame" class="hidden">
    ğŸ‘¤ <span id="name"></span><br>
    â± <span id="time">60</span> ç§’ã€€
    ğŸ¯ Lv <span id="levelI">1</span>ã€€
    ğŸ”¥ <span id="comboI">0</span><br>
    â­ <span id="scoreI">1.0</span>

    <div id="arrow" class="arrow"></div>
    <div id="feedback"></div>

    <button onclick="answerI('left')">â†</button>
    <button onclick="answerI('up')">â†‘</button>
    <button onclick="answerI('right')">â†’</button>
  </div>

  <div id="instantResult" class="hidden overlay">
    <h2>ğŸ‰ çµæœ</h2>
    <p id="finalScoreI"></p>
    <h3>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
    <ol id="instantRanking"></ol>
    <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
  </div>
</div>

<!-- ===== å›è»¢åˆ¤æ–­ ===== -->
<div id="spinScreen" class="screen hidden">
  <div id="game">
    <div id="info">
      Lv <span id="level">1</span>
      ğŸ”¥ <span id="combo">0</span>
      â­ <span id="score">1.0</span>
      â± <span id="timeSpin">60</span>
    </div>
    <div id="result"></div>
    <div id="center"><div id="arrowSpin">â†‘</div></div>
  </div>
</div>

<div id="spinResult" class="screen hidden">
  <h2>ğŸ‰ çµæœ</h2>
  <p id="finalScore"></p>
  <ol id="spinRanking"></ol>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== ç”»é¢åˆ¶å¾¡ ===== */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function backTop(){
  document.body.style.background='#111';
  show('top');
}

/* ===== ç¬é–“åˆ¤æ–­ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãã®ã¾ã¾ï¼‰ ===== */
let levelI=1, comboI=0, maxCombo=0, timeI=60, timerI=null, qTimer=null;
let current='', answeredI=false, player='';
const arrows=['left','up','right'];
const icons={left:'â†',up:'â†‘',right:'â†’'};
const showTimes=[1500,1300,1100,900,750,600,450];

function startInstant(){ show('instantScreen'); }
function instantStartGame(){
  player=document.getElementById('playerName').value||'ã‚²ã‚¹ãƒˆ';
  document.getElementById('name').textContent=player;
  document.getElementById('instantStart').classList.add('hidden');
  document.getElementById('instantGame').classList.remove('hidden');

  timerI=setInterval(()=>{
    timeI--; document.getElementById('time').textContent=timeI;
    if(timeI<=0) endInstant();
  },1000);
  nextI();
}
function nextI(){
  answeredI=false;
  current=arrows[Math.floor(Math.random()*3)];
  document.getElementById('arrow').textContent=icons[current];
  qTimer=setTimeout(()=>judgeI(false), showTimes[levelI-1]);
}
function answerI(c){ if(!answeredI) judgeI(c===current); }
function judgeI(ok){
  answeredI=true; clearTimeout(qTimer);
  document.getElementById('arrow').textContent='';
  if(ok){ comboI++; maxCombo=Math.max(maxCombo,comboI); if(comboI>=5&&levelI<7){levelI++;comboI=0;} }
  else comboI=0;
  document.getElementById('levelI').textContent=levelI;
  document.getElementById('comboI').textContent=comboI;
  document.getElementById('scoreI').textContent=`${levelI}.${maxCombo}`;
  setTimeout(nextI,400);
}
function endInstant(){
  clearInterval(timerI);
  const s=document.getElementById('scoreI').textContent;
  const list=JSON.parse(localStorage.getItem('instantRanking')||'[]');
  list.push({name:player,score:s});
  list.sort((a,b)=>b.score-a.score);
  localStorage.setItem('instantRanking',JSON.stringify(list.slice(0,20)));
  const ol=document.getElementById('instantRanking');
  ol.innerHTML='';
  list.forEach((r,i)=>{ const li=document.createElement('li'); li.textContent=`${i+1}. ${r.name} (${r.score})`; ol.appendChild(li); });
  document.getElementById('finalScoreI').textContent=`ã‚¹ã‚³ã‚¢ï¼š${s}`;
  document.getElementById('instantGame').classList.add('hidden');
  document.getElementById('instantResult').classList.remove('hidden');
}

/* ===== å›è»¢åˆ¤æ–­ï¼ˆå‰å›å®Œæˆç‰ˆãƒ»çœç•¥ãªã—ã§æ¥ç¶šæ¸ˆï¼‰ ===== */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=120, center=160;
let rackets=[], correct=0, answered=false, timer=null;
let level=1, combo=0, timeLeft=60, gameTimer=null, gameEnd=false;

function startSpin(){
  show('spinScreen');
  level=1; combo=0; timeLeft=60; gameEnd=false;
  document.getElementById('timeSpin').textContent=timeLeft;
  gameTimer=setInterval(()=>{ timeLeft--; document.getElementById('timeSpin').textContent=timeLeft; if(timeLeft<=0) endSpin(); },1000);
  nextSpin();
}

anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-25+'px';
  b.style.top=center+radius*Math.sin(a)-25+'px';
  b.onclick=()=>judgeSpin(i===correct);
  rackets.push(b);
  document.getElementById('game').appendChild(b);
});

function nextSpin(){
  answered=false;
  rackets.forEach(r=>r.classList.remove('active'));
  correct=Math.floor(Math.random()*8);
  document.getElementById('arrowSpin').style.transform=`rotate(${anglesDeg[correct]+90}deg)`;
  rackets[correct].classList.add('active');
  timer=setTimeout(()=>judgeSpin(false),700);
}
function judgeSpin(ok){
  if(answered) return;
  answered=true; clearTimeout(timer);
  if(ok){ combo++; if(combo>=5&&level<7){level++;combo=0;} }
  else combo=0;
  document.getElementById('level').textContent=level;
  document.getElementById('combo').textContent=combo;
  document.getElementById('score').textContent=`${level}.${combo}`;
  setTimeout(nextSpin,500);
}
function endSpin(){
  clearInterval(gameTimer);
  const s=document.getElementById('score').textContent;
  const list=JSON.parse(localStorage.getItem('spinRanking')||'[]');
  list.push(s); list.sort((a,b)=>b-a);
  localStorage.setItem('spinRanking',JSON.stringify(list.slice(0,20)));
  const ol=document.getElementById('spinRanking');
  ol.innerHTML='';
  list.forEach((r,i)=>{ const li=document.createElement('li'); li.textContent=`${i+1}. ${r}`; ol.appendChild(li); });
  document.getElementById('finalScore').textContent=`ã‚¹ã‚³ã‚¢ï¼š${s}`;
  show('spinResult');
}
</script>

</body>
</html>
