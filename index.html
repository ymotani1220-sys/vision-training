<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>å“çƒãƒã‚¦ãƒ³ãƒ‰åˆ¤æ–­ã‚²ãƒ¼ãƒ </title>

<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:sans-serif;
  text-align:center;
}

/* ===== ã‚²ãƒ¼ãƒ ç”»é¢ï¼ˆç¸¦æŒã¡ï¼‰ ===== */
#game{
  position:relative;
  width:100%;
  max-width:420px;
  height:80vh;
  margin:0 auto;
  background:#f5f5f5;
  border-radius:12px;
  overflow:hidden;
}

/* åºŠ */
#floor{
  position:absolute;
  bottom:0;
  width:100%;
  height:6px;
  background:#333;
}

/* ãƒœãƒ¼ãƒ« */
#ball{
  position:absolute;
  width:22px;
  height:22px;
  border-radius:50%;
  background:orange;
  touch-action:none;
}

/* çµæœ */
#result{
  height:80px;
  font-size:72px;
  font-weight:bold;
  margin-top:10px;
}

/* æƒ…å ± */
#info{
  font-size:20px;
  margin-bottom:8px;
}
</style>
</head>

<body>

<h2>ğŸ“ ãƒã‚¦ãƒ³ãƒ‰åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h2>

<div id="info">Lv 1</div>

<div id="game">
  <div id="ball"></div>
  <div id="floor"></div>
</div>

<div id="result"></div>

<script>
/* ===== ãƒ¬ãƒ™ãƒ«è¨­å®šï¼ˆã‚„ã•ã—ã‚ï¼‰ ===== */
const levels = [
  { gravity:0.22, speed:1.4 },
  { gravity:0.26, speed:1.7 },
  { gravity:0.30, speed:2.0 },
  { gravity:0.34, speed:2.3 }
];

const game = document.getElementById("game");
const ball = document.getElementById("ball");
const result = document.getElementById("result");
const info = document.getElementById("info");

let level = 0;
let success = 0;

let x,y,vx,vy;
let bounceCount = 0;
let canTouch = false;
let touched = false;
let active = true;

function resetBall(){
  const w = game.clientWidth;
  const h = game.clientHeight;

  x = 20;
  y = h * 0.2;
  vx = levels[level].speed;
  vy = 0;

  bounceCount = 0;
  canTouch = false;
  touched = false;
  active = true;

  ball.style.display = "block";
}

/* ===== ç‰©ç†å‡¦ç† ===== */
function update(){
  if(!active){
    requestAnimationFrame(update);
    return;
  }

  const g = levels[level].gravity;
  const floorY = game.clientHeight - 22;

  x += vx;
  y += vy;
  vy += g;

  if(y >= floorY){
    y = floorY;
    vy = -vy * 0.85;
    bounceCount++;

    if(bounceCount === 1){
      canTouch = true;        // â˜… 1ãƒã‚¦ãƒ³ãƒ‰å¾Œ
    }

    if(bounceCount === 2){
      ball.style.display = "none"; // â˜… 2ãƒã‚¦ãƒ³ãƒ‰ã§æ¶ˆã™
      if(!touched) showResult(false);
    }
  }

  ball.style.left = x + "px";
  ball.style.top  = y + "px";

  requestAnimationFrame(update);
}

/* ===== ãƒœãƒ¼ãƒ«ã ã‘ã‚¿ãƒƒãƒåˆ¤å®š ===== */
ball.addEventListener("pointerdown", ()=>{
  if(!canTouch || touched || !active) return;

  touched = true;
  active = false;
  ball.style.display = "none";
  showResult(true);
});

/* ===== åˆ¤å®š ===== */
function showResult(ok){
  active = false;

  if(ok){
    result.textContent = "ã€‡";
    result.style.color = "#0f9";
    success++;

    if(success >= 3 && level < levels.length-1){
      level++;
      success = 0;
    }
  }else{
    result.textContent = "âœ–";
    result.style.color = "#f33";
    success = 0;
  }

  info.textContent = `Lv ${level+1}`;

  setTimeout(()=>{
    result.textContent = "";
    resetBall();
    active = true;
  },800);
}

resetBall();
update();
</script>

</body>
</html>
