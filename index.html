<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒ å›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.4s;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none}
button{font-size:22px;padding:14px 30px}

/* ===== ãƒˆãƒƒãƒ— ===== */
#top h1{font-size:22px;margin-bottom:20px}

/* ===== ã‚²ãƒ¼ãƒ  ===== */
#game{position:relative;width:320px;height:320px}
#info{
  position:absolute;top:-90px;width:100%;
  text-align:center;font-size:18px
}
#result{
  position:absolute;top:-35px;left:50%;
  transform:translateX(-50%);
  font-size:34px;font-weight:bold;height:40px
}
#center{
  position:absolute;top:50%;left:50%;
  width:80px;height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;background:#fff;
  display:flex;justify-content:center;align-items:center
}
#arrow{font-size:46px;font-weight:900;color:#f33}

/* ãƒ©ã‚±ãƒƒãƒˆ */
.spin-btn{
  position:absolute;width:50px;height:50px;
  border-radius:50%;background:#c00;border:none
}
.spin-btn.active{background:#0f9}
</style>
</head>

<body>

<!-- ===== ãƒˆãƒƒãƒ— ===== -->
<div id="top" class="screen">
  <h1>ğŸ“ å“çƒå›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<!-- ===== ã‚²ãƒ¼ãƒ  ===== -->
<div id="gameScreen" class="screen hidden">
  <div id="game">
    <div id="info">
      Lv <span id="level">1</span>
      ğŸ”¥ <span id="combo">0</span>
      â­ <span id="score">1.0</span>
      â± <span id="time">60</span>
    </div>
    <div id="result"></div>
    <div id="center"><div id="arrow">â†‘</div></div>
  </div>
</div>

<!-- ===== çµ‚äº† ===== -->
<div id="end" class="screen hidden">
  <h2>ğŸ‰ çµ‚äº†</h2>
  <p id="finalScore"></p>
  <button onclick="location.reload()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== è¨­å®š ===== */
const bgColors=['#111','#0b1a2a','#102a1c','#2a1c10','#2a1010','#1a102a','#2a002a'];
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=120, center=160;
const showTimes=[1200,1000,850,700,600,500,400];

const arrow=document.getElementById('arrow');
const result=document.getElementById('result');
const levelEl=document.getElementById('level');
const comboEl=document.getElementById('combo');
const scoreEl=document.getElementById('score');
const timeEl=document.getElementById('time');

let rackets=[];
let correctIndex=0;
let answered=false;
let questionTimer=null;
let gameTimer=null;

let level=1;
let combo=0;
let timeLeft=60;
let gameEnd=false;

/* ===== ãƒ©ã‚±ãƒƒãƒˆç”Ÿæˆ ===== */
anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-25+'px';
  b.style.top =center+radius*Math.sin(a)-25+'px';
  b.onclick=()=>answer(i);
  rackets.push(b);
  document.getElementById('game').appendChild(b);
});

/* ===== é–‹å§‹ ===== */
function startGame(){
  document.getElementById('top').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');

  level=1;combo=0;timeLeft=60;gameEnd=false;
  updateUI();updateBg();

  gameTimer=setInterval(()=>{
    timeLeft--;
    timeEl.textContent=timeLeft;
    if(timeLeft<=0) endGame();
  },1000);

  nextQuestion();
}

/* ===== å‡ºé¡Œ ===== */
function nextQuestion(){
  if(gameEnd) return;

  clearTimeout(questionTimer);
  answered=false;
  result.textContent='';
  rackets.forEach(r=>r.classList.remove('active'));

  correctIndex=Math.floor(Math.random()*8);
  arrow.style.transform=`rotate(${anglesDeg[correctIndex]+90}deg)`;
  rackets[correctIndex].classList.add('active');

  questionTimer=setTimeout(()=>{
    if(!answered) judge(false);
  }, showTimes[level-1]);
}

/* ===== å›ç­” ===== */
function answer(i){
  if(answered||gameEnd) return;
  judge(i===correctIndex);
}

/* ===== åˆ¤å®š ===== */
function judge(isCorrect){
  if(answered||gameEnd) return;
  answered=true;
  clearTimeout(questionTimer);
  rackets.forEach(r=>r.classList.remove('active'));

  if(isCorrect){
    result.textContent='ã€‡';
    result.style.color='#0f9';
    combo++;
    if(combo>=5 && level<7){
      level++;
      combo=0;
      updateBg();
    }
  }else{
    result.textContent='âœ–';
    result.style.color='#f00';
    combo=0;
  }

  updateUI();
  setTimeout(nextQuestion,600);
}

/* ===== è¡¨ç¤º ===== */
function updateUI(){
  levelEl.textContent=level;
  comboEl.textContent=combo;
  scoreEl.textContent=`${level}.${combo}`;
}
function updateBg(){
  document.body.style.background=bgColors[level-1];
}

/* ===== çµ‚äº† ===== */
function endGame(){
  gameEnd=true;
  clearInterval(gameTimer);
  clearTimeout(questionTimer);
  document.getElementById('gameScreen').classList.add('hidden');
  document.getElementById('end').classList.remove('hidden');
  document.getElementById('finalScore').textContent=
    `ã‚¹ã‚³ã‚¢ï¼š${scoreEl.textContent}`;
}
</script>

</body>
</html>
