<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÂçìÁêÉÁ∑èÂêà„Éà„É¨„Éº„Éã„É≥„Ç∞ - ‰∏â‰Ωç‰∏Ä‰Ωìver</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.8s ease;
  overflow: hidden;
  touch-action: manipulation;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none}
button{font-size:20px;padding:16px 28px;margin:10px;cursor:pointer;border-radius:12px;border:none;background:#eee;color:#111;font-weight:bold;}

/* ===== ÂÖ±ÈÄöUI ===== */
.info-panel { font-size: 20px; margin-bottom: 10px; text-align: center; line-height: 1.5; z-index: 10; }
.score-highlight { font-size: 28px; color: #ffeb3b; font-weight: bold; }

/* ===== 1. ÂõûËª¢Âà§Êñ≠ ===== */
#spinGame{position:relative;width:320px;height:320px}
#spinCenter{
  position:absolute; top:50%; left:50%; width:80px; height:80px;
  transform:translate(-50%, -50%); border-radius:50%; background:#fff;
  display:flex; justify-content:center; align-items:center;
  box-shadow: 0 0 15px rgba(255,255,255,0.5); z-index: 5;
}
#spinArrow{font-size:50px;font-weight:900;color:#f33;transition: transform 0.15s ease-out;}
.spin-btn{
  position:absolute; width:56px; height:56px; border-radius:50%;
  background:#444; border:3px solid #fff; z-index: 6;
}
.spin-btn.active{background:#0f9;box-shadow: 0 0 20px #0f9;}

/* ===== 2. Áû¨ÈñìÂà§Êñ≠ ===== */
.flash-arrow-display{font-size:130px;margin:5px;height:140px;line-height:140px;}
.flash-controls button{background:#555;color:white;min-width: 90px;font-size:35px;}

/* ===== 3. ÊâìÁÇπÂà§Êñ≠ ===== */
#hitGameArea { position:relative; width:100%; max-width:400px; height:400px; overflow:hidden; border-bottom: 4px solid #888; }
#hitBall {
  position:absolute; width:48px; height:48px; border-radius:50%;
  background:#fff; box-shadow:0 0 14px rgba(255,255,255,0.9);
}
</style>
</head>

<body>

<div id="topScreen" class="screen">
  <h1 style="margin-bottom:30px;">üèì ÂçìÁêÉ„Éà„É¨„Éº„Éã„É≥„Ç∞</h1>
  <button onclick="startSpin()">1. ÂõûËª¢Âà§Êñ≠</button>
  <button onclick="startFlash()">2. Áû¨ÈñìÂà§Êñ≠</button>
  <button onclick="startHit()">3. ÊâìÁÇπÂà§Êñ≠</button>
</div>

<div id="spinScreen" class="screen hidden">
  <div class="info-panel">
    ‚è± <span id="spinTimeDisp">60</span><br>
    „Çπ„Ç≥„Ç¢Ôºö<span id="spinScoreDisp" class="score-highlight">1.0</span>
  </div>
  <div id="spinGame">
    <div id="feedbackSpin" style="position:absolute; top:-50px; width:100%; text-align:center; font-size:40px;"></div>
    <div id="spinCenter"><div id="spinArrow">‚Üë</div></div>
  </div>
</div>

<div id="flashScreen" class="screen hidden">
  <div class="info-panel">
    ‚è± <span id="flashTimeDisp">60</span><br>
    „Çπ„Ç≥„Ç¢Ôºö<span id="flashScoreDisp" class="score-highlight">1.0</span>
  </div>
  <div id="flashArrow" class="flash-arrow-display"></div>
  <div id="feedbackFlash" style="font-size:45px; height:55px; font-weight:bold;"></div>
  <div class="flash-controls">
    <button onclick="answerFlash('left')">‚Üê</button>
    <button onclick="answerFlash('up')">‚Üë</button>
    <button onclick="answerFlash('right')">‚Üí</button>
  </div>
</div>

<div id="hitScreen" class="screen hidden">
  <div class="info-panel">
    ‚è± <span id="hitTimeDisp">60</span><br>
    „Çπ„Ç≥„Ç¢Ôºö<span id="hitScoreDisp" class="score-highlight">1.0</span>
  </div>
  <div id="feedbackHit" style="font-size:40px; height:45px; font-weight:bold;"></div>
  <div id="hitGameArea">
    <div id="hitBall"></div>
  </div>
  <p style="color:#ffeb3b; font-weight:bold; margin-top:15px;">„Éú„Éº„É´„Åå„Éê„Ç¶„É≥„Éâ„Åó„Åü„Çâ„Éú„Éº„É´„Å´„Çø„ÉÉ„ÉÅÔºÅ</p>
</div>

<div id="endScreen" class="screen hidden">
  <h2 id="endTitle" style="font-size:32px;">„Éà„É¨„Éº„Éã„É≥„Ç∞ÁµÇ‰∫ÜÔºÅ</h2>
  <p id="finalScore" class="score-highlight" style="font-size:48px; margin:10px 0;"></p>
  <button onclick="backTop()">„Éà„ÉÉ„Éó„Å∏Êàª„Çã</button>
</div>

<script>
/* ===== ÂÖ±ÈÄöË®≠ÂÆö ===== */
const bgColors=['#111','#1a2635','#1a3526','#352a1a','#351a1a','#261a35','#351a35','#4a148c','#004d40'];
const speedSettings=[1500, 1200, 1000, 850, 700, 550, 450, 350];

let gameTimer = null;
let gameTimeLeft = 60;
let currentLvl = 1;
let currentCombo = 0;

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function updateBg(lvl){
  document.body.style.background = bgColors[Math.min(lvl-1, bgColors.length-1)];
}
function startGlobalTimer(displayId, endFunc){
  gameTimeLeft = 60;
  document.getElementById(displayId).textContent = gameTimeLeft;
  if(gameTimer) clearInterval(gameTimer);
  gameTimer = setInterval(()=>{
    gameTimeLeft--;
    document.getElementById(displayId).textContent = gameTimeLeft;
    if(gameTimeLeft <= 0) endFunc();
  }, 1000);
}

/* ================= 1. ÂõûËª¢Âà§Êñ≠ (Spin) ================= */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
let rackets=[], correctIdx=0, answeredSpin=false, spinNextTimer=null;

const spinArea = document.getElementById('spinGame');
anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left = (160 + 120 * Math.cos(a) - 28) + 'px';
  b.style.top  = (160 + 120 * Math.sin(a) - 28) + 'px';
  b.onclick=()=>judgeSpin(i===correctIdx);
  rackets.push(b);
  spinArea.appendChild(b);
});

function startSpin(){
  currentLvl=1; currentCombo=0;
  updateSpinScore(); updateBg(1);
  show('spinScreen');
  startGlobalTimer('spinTimeDisp', endSpin);
  nextSpin();
}

function nextSpin(){
  if(gameTimeLeft<=0) return;
  answeredSpin=false;
  document.getElementById('feedbackSpin').textContent='';
  rackets.forEach(r=>r.classList.remove('active'));
  correctIdx=Math.floor(Math.random()*8);
  document.getElementById('spinArrow').style.transform=`rotate(${anglesDeg[correctIdx]+90}deg)`;
  rackets[correctIdx].classList.add('active');
  if(spinNextTimer) clearTimeout(spinNextTimer);
  spinNextTimer=setTimeout(()=>judgeSpin(false), speedSettings[Math.min(currentLvl-1, 7)]);
}

function judgeSpin(ok){
  if(answeredSpin || gameTimeLeft<=0) return;
  answeredSpin=true; clearTimeout(spinNextTimer);
  const fb = document.getElementById('feedbackSpin');
  if(ok){
    fb.textContent='„Äá'; fb.style.color='#0f9'; currentCombo++;
    if(currentCombo >= 5){ currentLvl++; currentCombo=0; updateBg(currentLvl); }
  } else {
    fb.textContent='‚úñ'; fb.style.color='#f00'; currentCombo=0;
  }
  updateSpinScore();
  setTimeout(nextSpin, 600);
}

function updateSpinScore(){ document.getElementById('spinScoreDisp').textContent = `${currentLvl}.${currentCombo}`; }
function endSpin(){ clearInterval(gameTimer); clearTimeout(spinNextTimer); showFinalScore(); }

/* ================= 2. Áû¨ÈñìÂà§Êñ≠ (Flash) ================= */
let flashNextTimer=null, currentDir='', answeredFlash=false;
function startFlash(){
  currentLvl=1; currentCombo=0;
  updateFlashScore(); updateBg(1);
  show('flashScreen');
  startGlobalTimer('flashTimeDisp', endFlash);
  nextFlash();
}
function nextFlash(){
  if(gameTimeLeft<=0) return;
  answeredFlash=false;
  document.getElementById('feedbackFlash').textContent='';
  currentDir=['left','up','right'][Math.floor(Math.random()*3)];
  const icons={left:'‚Üê',up:'‚Üë',right:'‚Üí'};
  document.getElementById('flashArrow').textContent=icons[currentDir];
  if(flashNextTimer) clearTimeout(flashNextTimer);
  flashNextTimer=setTimeout(()=>judgeFlash(null), speedSettings[Math.min(currentLvl-1, 7)]);
}
function answerFlash(a){ if(!answeredFlash) judgeFlash(a === currentDir); }
function judgeFlash(ok){
  if(answeredFlash || gameTimeLeft<=0) return;
  answeredFlash=true; clearTimeout(flashNextTimer);
  document.getElementById('flashArrow').textContent='';
  const fb = document.getElementById('feedbackFlash');
  if(ok){
    fb.textContent='„Äá'; fb.style.color='#0f9'; currentCombo++;
    if(currentCombo >= 5){ currentLvl++; currentCombo=0; updateBg(currentLvl); }
  } else {
    fb.textContent='‚úñ'; fb.style.color='#f00'; currentCombo=0;
  }
  updateFlashScore();
  setTimeout(nextFlash, 600);
}
function updateFlashScore(){ document.getElementById('flashScoreDisp').textContent = `${currentLvl}.${currentCombo}`; }
function endFlash(){ clearInterval(gameTimer); clearTimeout(flashNextTimer); showFinalScore(); }

/* ================= 3. ÊâìÁÇπÂà§Êñ≠ (Hit) ================= */
let hX=0, hY=0, hVX=0, hVY=0, hGrav=0.6, hMag=0, hBounced=0, hRunning=false, hTouched=false;
const hitBall = document.getElementById('hitBall');

function startHit(){
  currentLvl=1; currentCombo=0;
  updateHitScore(); updateBg(1);
  show('hitScreen');
  startGlobalTimer('hitTimeDisp', endHit);
  serveHit();
}

function serveHit(){
  if(gameTimeLeft<=0) return;
  hBounced=0; hTouched=false; hRunning=true;
  document.getElementById('feedbackHit').textContent='';
  hX=20; hY=150;
  
  // Áâ©ÁêÜË®≠ÂÆö„ÅÆÊõ¥Êñ∞
  hVX = 3 + currentLvl*0.8 + (currentLvl>5 ? (currentLvl-5)*2 : 0);
  if(currentLvl<=4){ hVY = -4 + currentLvl*0.5; hMag=0; }
  else { hVY = currentLvl-5; hMag = 0.01 + (currentLvl-5)*0.02; }
  hGrav = currentLvl<3 ? 0.3 : 0.6;

  // „É´„Éº„Éó„ÇíÂÜçÈñã
  requestAnimationFrame(hitLoop);
}

hitBall.addEventListener('pointerdown', ()=>{
  if(hBounced===1 && !hTouched && hRunning){
    hTouched=true; hRunning=false; // ‰∏ÄÊó¶Ê≠¢„ÇÅ„Å¶Âà§ÂÆö
    const fb = document.getElementById('feedbackHit');
    fb.textContent='„Äá'; fb.style.color='#0f9'; currentCombo++;
    if(currentCombo>=5){ currentLvl++; currentCombo=0; updateBg(currentLvl); }
    updateHitScore();
    setTimeout(serveHit, 600);
  }
});

function hitLoop(){
  if(!hRunning || gameTimeLeft<=0) return;

  hVY += hGrav + hMag;
  hX += hVX; hY += hVY;

  // „Éê„Ç¶„É≥„ÉâÂá¶ÁêÜ
  if(hY + 24 >= 400 && hVY > 0){
    hY = 400 - 24; hVY = -hVY * 0.85; hBounced++;
    if(hBounced>=2){
      hRunning=false;
      const fb = document.getElementById('feedbackHit');
      fb.textContent='‚úñ'; fb.style.color='#f33'; currentCombo=0;
      updateHitScore();
      setTimeout(serveHit, 600);
      return; // „É´„Éº„ÉóÁµÇ‰∫Ü
    }
  }

  // ÁîªÈù¢Á´Ø„Å´„ÅÑ„Å£„Åü„Çâ„Éü„Çπ„Å®„Åó„Å¶„É™„Çª„ÉÉ„Éà
  if(hX > 420){
    hRunning=false;
    setTimeout(serveHit, 300);
    return;
  }

  hitBall.style.transform = `translate(${hX-24}px, ${hY-24}px)`;
  requestAnimationFrame(hitLoop);
}

function updateHitScore(){ document.getElementById('hitScoreDisp').textContent = `${currentLvl}.${currentCombo}`; }
function endHit(){ hRunning=false; clearInterval(gameTimer); showFinalScore(); }

/* ===== ÁµÇ‰∫Ü„ÉªÊàª„Çã ===== */
function showFinalScore(){
  document.getElementById('finalScore').textContent = `${currentLvl}.${currentCombo}`;
  show('endScreen');
}
function backTop(){ updateBg(1); show('topScreen'); }
</script>

</body>
</html>
