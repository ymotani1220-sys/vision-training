<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒãƒˆ</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.4s;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{ display:none; }

button{
  font-size:20px;
  padding:14px 28px;
  border:none;
  border-radius:14px;
  cursor:pointer;
}

/* ===== ãƒˆãƒƒãƒ— ===== */
#top h1{
  font-size:24px;
  margin-bottom:30px;
}
.menu button{
  width:260px;
  margin:10px 0;
}

/* ===== å…±é€šã‚²ãƒ¼ãƒ UI ===== */
#game{
  position:relative;
  width:320px;
  height:320px;
}
#info{
  position:absolute;
  top:-90px;
  width:100%;
  text-align:center;
  font-size:18px;
}
#result{
  position:absolute;
  top:-35px;
  left:50%;
  transform:translateX(-50%);
  font-size:34px;
  font-weight:bold;
  height:40px;
}
#center{
  position:absolute;
  top:50%;
  left:50%;
  width:80px;
  height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
}
#arrow{
  font-size:46px;
  font-weight:900;
  color:#f33;
}

/* ===== ãƒ©ã‚±ãƒƒãƒˆ ===== */
.spin-btn{
  position:absolute;
  width:50px;
  height:50px;
  border-radius:50%;
  background:#c00;
  border:none;
}
.spin-btn::after{
  content:'';
  position:absolute;
  bottom:-18px;
  left:50%;
  width:12px;
  height:22px;
  background:#caa;
  transform:translateX(-50%);
}
.spin-btn.active{ background:#0f9; }

/* ===== çµæœ ===== */
#ranking{
  width:280px;
  text-align:left;
}
</style>
</head>

<body>

<!-- ===== ãƒˆãƒƒãƒ— ===== -->
<div id="top" class="screen">
  <h1>ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <div class="menu">
    <button onclick="startSpin()">å›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
    <button onclick="startQuick()">ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
  </div>
</div>

<!-- ===== å›è»¢åˆ¤æ–­ ===== -->
<div id="spinScreen" class="screen hidden">
  <div id="game">
    <div id="info">
      Lv <span id="spinLevel">1</span>
      ğŸ”¥ <span id="spinCombo">0</span>
      â­ <span id="spinScore">1.0</span>
      â± <span id="spinTime">60</span>
    </div>
    <div id="result"></div>
    <div id="center"><div id="arrow">â†‘</div></div>
  </div>
</div>

<div id="spinResult" class="screen hidden">
  <h2>ğŸ‰ å›è»¢åˆ¤æ–­ çµæœ</h2>
  <p id="spinFinal"></p>
  <div id="ranking">
    <h3>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
    <ol id="spinRanking"></ol>
  </div>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<!-- ===== ç¬é–“åˆ¤æ–­ ===== -->
<div id="quickScreen" class="screen hidden">
  <div id="game">
    <div id="info">
      Lv <span id="quickLevel">1</span>
      â­ <span id="quickScore">0</span>
      â± <span id="quickTime">60</span>
    </div>
  </div>
</div>

<div id="quickResult" class="screen hidden">
  <h2>ğŸ‰ ç¬é–“åˆ¤æ–­ çµæœ</h2>
  <p id="quickFinal"></p>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== å…±é€š ===== */
const bgColors=['#111','#0b1a2a','#102a1c','#2a1c10','#2a1010','#1a102a','#2a002a'];
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function backTop(){
  document.body.style.background='#111';
  show('top');
}

/* ===== å›è»¢åˆ¤æ–­ ===== */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=120,center=160;
const showTimes=[1200,1000,850,700,600,500,400];

let spinLevel=1,spinCombo=0,spinTime=60,spinTimer=null,spinEnd=false;
let correct=0,answered=false,timer=null;
const arrow=document.getElementById('arrow');
const result=document.getElementById('result');
const rackets=[];

anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-25+'px';
  b.style.top =center+radius*Math.sin(a)-25+'px';
  b.onclick=()=>spinAnswer(i);
  rackets.push(b);
  document.querySelector('#spinScreen #game').appendChild(b);
});

function startSpin(){
  show('spinScreen');
  spinLevel=1; spinCombo=0; spinTime=60; spinEnd=false;
  updateSpinUI(); updateBG();
  spinTimer=setInterval(()=>{
    spinTime--;
    document.getElementById('spinTime').textContent=spinTime;
    if(spinTime<=0) endSpin();
  },1000);
  nextSpin();
}
function nextSpin(){
  if(spinEnd) return;
  answered=false; result.textContent='';
  rackets.forEach(r=>r.classList.remove('active'));
  correct=Math.floor(Math.random()*8);
  arrow.style.transform=`rotate(${anglesDeg[correct]+90}deg)`;
  rackets[correct].classList.add('active');
  timer=setTimeout(()=>judgeSpin(false),showTimes[spinLevel-1]);
}
function spinAnswer(i){
  if(answered||spinEnd) return;
  judgeSpin(i===correct);
}
function judgeSpin(ok){
  answered=true;
  clearTimeout(timer);
  rackets.forEach(r=>r.classList.remove('active'));
  if(ok){
    result.textContent='ã€‡'; result.style.color='#0f9';
    spinCombo++;
    if(spinCombo>=5&&spinLevel<7){spinLevel++;spinCombo=0;updateBG();}
  }else{
    result.textContent='âœ–'; result.style.color='#f00';
    spinCombo=0;
  }
  updateSpinUI();
  setTimeout(nextSpin,600);
}
function updateSpinUI(){
  document.getElementById('spinLevel').textContent=spinLevel;
  document.getElementById('spinCombo').textContent=spinCombo;
  document.getElementById('spinScore').textContent=`${spinLevel}.${spinCombo}`;
}
function updateBG(){ document.body.style.background=bgColors[spinLevel-1]; }
function endSpin(){
  spinEnd=true;
  clearInterval(spinTimer);
  document.getElementById('spinFinal').textContent=
    `ã‚¹ã‚³ã‚¢ï¼š${spinLevel}.${spinCombo}`;
  show('spinResult');
}

/* ===== ç¬é–“åˆ¤æ–­ ===== */
let quickLevel=1,quickScore=0,quickTime=60,quickTimer=null;
let quickCorrect=0;

function startQuick(){
  show('quickScreen');
  quickLevel=1; quickScore=0; quickTime=60;
  document.getElementById('quickScore').textContent=0;
  document.body.style.background=bgColors[0];
  quickTimer=setInterval(()=>{
    quickTime--;
    document.getElementById('quickTime').textContent=quickTime;
    if(quickTime<=0) endQuick();
  },1000);
  nextQuick();
}
function nextQuick(){
  const idx=Math.floor(Math.random()*8);
  rackets.forEach(r=>r.classList.remove('active'));
  rackets[idx].classList.add('active');
  quickCorrect=idx;
}
rackets.forEach((b,i)=>{
  b.addEventListener('click',()=>{
    if(document.getElementById('quickScreen').classList.contains('hidden'))return;
    if(i===quickCorrect){
      quickScore++;
      if(quickScore%5===0&&quickLevel<7){
        quickLevel++;
        document.body.style.background=bgColors[quickLevel-1];
      }
    }
    document.getElementById('quickScore').textContent=quickScore;
    nextQuick();
  });
});
function endQuick(){
  clearInterval(quickTimer);
  document.getElementById('quickFinal').textContent=
    `ã‚¹ã‚³ã‚¢ï¼š${quickScore}`;
  show('quickResult');
}
</script>

</body>
</html>
