<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #111;
  color: #fff;
  margin: 0;
}

#game { padding: 20px; }

.arrow {
  font-size: 100px;
  margin: 30px 0;
}

#feedback {
  font-size: 40px;
  height: 50px;
}

.correct { color: #00ff99; }
.wrong { color: #ff5555; }

button {
  font-size: 22px;
  padding: 15px 25px;
  margin: 10px;
}

.hidden { display: none; }
</style>
</head>

<body>

<div id="startScreen">
  <h1>ğŸ“ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <input id="playerName" placeholder="åå‰ã‚’å…¥åŠ›" />
  <br><br>
  <button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="game" class="hidden">
  ğŸ‘¤ <span id="nameDisplay"></span><br>
  â± æ®‹ã‚Š <span id="time">60</span> ç§’<br>
  ğŸ¯ ãƒ¬ãƒ™ãƒ« <span id="level">1</span><br>
  ğŸ”¥ é€£ç¶š <span id="combo">0</span><br>
  â­ ã‚¹ã‚³ã‚¢ <span id="score">1.0</span>

  <div id="arrow" class="arrow"></div>
  <div id="feedback"></div>

  <button onclick="answer('left')">â†</button>
  <button onclick="answer('up')">â†‘</button>
  <button onclick="answer('right')">â†’</button>
</div>

<div id="result" class="hidden">
  <h2>ğŸ‰ çµæœ</h2>
  <p id="finalScore"></p>
  <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦</button>
</div>

<script>
let level = 1;
let combo = 0;
let maxCombo = 0;
let time = 60;
let currentAnswer = '';
let timer;
let player = '';
let state = 'idle';

let showTimer = null;
let nextTimer = null;

const arrows = ['left','up','right'];
const arrowIcons = { left:'â†', up:'â†‘', right:'â†’' };

const showTimes = [1500,1300,1100,900,750,600,450];
const coolTimes = [600,550,500,450,400,350,300];

function clearTimers() {
  if (showTimer) clearTimeout(showTimer);
  if (nextTimer) clearTimeout(nextTimer);
  showTimer = null;
  nextTimer = null;
}

function startGame() {
  player = document.getElementById('playerName').value || 'ã‚²ã‚¹ãƒˆ';
  document.getElementById('nameDisplay').textContent = player;
  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');

  nextQuestion();
  timer = setInterval(countDown, 1000);
}

function countDown() {
  time--;
  document.getElementById('time').textContent = time;
  if (time <= 0) endGame();
}

function nextQuestion() {
  clearTimers();
  state = 'showing';
  document.getElementById('feedback').textContent = '';

  currentAnswer = arrows[Math.floor(Math.random() * 3)];
  const arrowEl = document.getElementById('arrow');
  arrowEl.textContent = arrowIcons[currentAnswer];

  showTimer = setTimeout(() => {
    if (state === 'showing') judge(false);
  }, showTimes[level - 1]);
}

function answer(choice) {
  if (state !== 'showing') return;
  judge(choice === currentAnswer);
}

function judge(correct) {
  clearTimers();
  state = 'judging';

  const fb = document.getElementById('feedback');
  document.getElementById('arrow').textContent = '';

  if (correct) {
    fb.textContent = 'âœ…';
    fb.className = 'correct';
    combo++;
    if (combo > maxCombo) maxCombo = combo;
    if (combo >= 5 && level < 7) {
      level++;
      combo = 0;
    }
  } else {
    fb.textContent = 'âŒ';
    fb.className = 'wrong';
    combo = 0;
  }

  updateDisplay();

  nextTimer = setTimeout(() => {
    state = 'idle';
    nextQuestion();
  }, coolTimes[level - 1]);
}

function updateDisplay() {
  document.getElementById('level').textContent = level;
  document.getElementById('combo').textContent = combo;
  document.getElementById('score').textContent = `${level}.${maxCombo}`;
}

function endGame() {
  clearTimers();
  clearInterval(timer);
  document.getElementById('game').classList.add('hidden');
  document.getElementById('result').classList.remove('hidden');

  document.getElementById('finalScore').textContent =
    `ã‚¹ã‚³ã‚¢ï¼š${level}.${maxCombo}`;
}
</script>

</body>
</html>
