<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>横回転判断ゲーム（単体版）</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #0b5c2d;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .info {
    display: flex;
    gap: 30px;
    margin: 10px 0;
    font-size: 18px;
  }

  .court-wrapper {
    position: relative;
    width: 320px;
    height: 520px;
    background: #1e7f43;
    border: 4px solid #fff;
    box-sizing: border-box;
  }

  /* 卓球台ライン */
  .sideline {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 4px;
    background: #fff;
  }
  .sideline.left { left: 30px; }
  .sideline.right { right: 30px; }

  .endline.top {
    position: absolute;
    top: 30px;
    left: 30px;
    right: 30px;
    height: 4px;
    background: #fff;
  }
  .endline.bottom {
    position: absolute;
    bottom: 30px;
    left: 30px;
    right: 30px;
    height: 4px;
    background: #fff;
  }

  .centerline {
    position: absolute;
    top: 30px;
    bottom: 30px;
    left: 50%;
    width: 4px;
    background: #fff;
    transform: translateX(-50%);
  }

  .net {
    position: absolute;
    top: 50%;
    left: 30px;
    right: 30px;
    height: 4px;
    background: #ddd;
  }

  /* 回転予測矢印 */
  .spin-indicator {
    position: absolute;
    font-size: 48px;
    font-weight: bold;
    display: none;
    transform: translate(-50%, -50%);
  }

  /* ボール */
  .ball {
    position: absolute;
    width: 24px;
    height: 24px;
    background: #fff;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    display: none;
  }

  /* ボタン */
  .buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px;
    margin: 10px 0 5px;
  }

  .btn {
    width: 90px;
    height: 40px;
    border-radius: 20px;
    background: #333;
    position: relative;
    border: none;
  }

  .btn.correct { background: #2ecc71; }
  .btn.wrong { background: #e74c3c; }

  .angle {
    position: absolute;
    width: 30px;
    height: 3px;
    background: #fff;
    top: 50%;
    left: 50%;
    transform-origin: center;
  }

  .left  { transform: translate(-50%, -50%) rotate(-30deg); }
  .flat  { transform: translate(-50%, -50%) rotate(0deg); }
  .right { transform: translate(-50%, -50%) rotate(30deg); }
</style>
</head>
<body>

<div class="info">
  <div>TIME: <span id="time">30</span></div>
  <div>SCORE: <span id="score">0</span></div>
</div>

<div class="court-wrapper" id="court">
  <div class="sideline left"></div>
  <div class="sideline right"></div>
  <div class="endline top"></div>
  <div class="endline bottom"></div>
  <div class="centerline"></div>
  <div class="net"></div>

  <div class="spin-indicator" id="spinArrow">⟲</div>
  <div class="ball" id="ball"></div>
</div>

<div class="buttons" id="buttons"></div>

<script>
const court = document.getElementById("court");
const ball = document.getElementById("ball");
const arrow = document.getElementById("spinArrow");
const buttons = document.getElementById("buttons");

const COURT_LEFT = 30;
const COURT_RIGHT = 290;
const TOP_Y = 60;
const BOTTOM_Y = 460;

const BALL_R = 12;

let correct = {};

function createButtons(){
  buttons.innerHTML = "";
  const spins = ["left","flat","right"];

  ["fore","middle","back"].forEach(course=>{
    spins.forEach(sp=>{
      const b = document.createElement("button");
      b.className = "btn";
      const line = document.createElement("div");
      line.className = "angle " + sp;
      b.appendChild(line);

      b.onclick = ()=>{
        if(correct.course === course && correct.spin === sp){
          b.classList.add("correct");
        } else {
          b.classList.add("wrong");
        }
      };
      buttons.appendChild(b);
    });
  });
}

function getStartX(course){
  if(course === "fore") return COURT_LEFT + BALL_R;
  if(course === "middle") return (COURT_LEFT + COURT_RIGHT)/2;
  return COURT_RIGHT - BALL_R;
}

function getTargetX(course){
  if(course === "fore") return COURT_LEFT + BALL_R;
  if(course === "middle") return (COURT_LEFT + COURT_RIGHT)/2;
  return COURT_RIGHT - BALL_R;
}

/* ★ 曲がり方向修正済み ★
   spin:
   0 = 反時計回り → 右に曲がる
   1 = 直進
   2 = 時計回り → 左に曲がる
*/
function curveOffset(p, spin){
  if(spin === 1) return 0;

  // ← ここが修正点（符号反転）
  const dir = (spin === 0) ? -1 : 1;

  const curvePower = 40;
  return Math.sin(p * Math.PI) * curvePower * dir;
}

function launchBall(){
  const courses = ["fore","middle","back"];
  const spins = [0,1,2];

  const course = courses[Math.floor(Math.random()*3)];
  const spin = spins[Math.floor(Math.random()*3)];

  correct = {
    course,
    spin: spin === 0 ? "right" : spin === 2 ? "left" : "flat"
  };

  const startX = getStartX(course);
  const targetX = getTargetX(course);

  const startY = TOP_Y;
  const endY = BOTTOM_Y;

  ball.style.display = "block";
  arrow.style.display = "block";

  arrow.textContent = spin === 0 ? "⟲" : spin === 2 ? "⟳" : "";
  arrow.style.left = startX + "px";
  arrow.style.top = (startY - 30) + "px";

  let t = 0;
  const duration = 3000;

  const timer = setInterval(()=>{
    t += 16;
    const p = Math.min(t/duration,1);

    const x = startX + (targetX-startX)*p + curveOffset(p,spin);
    const y = startY + (endY-startY)*p;

    ball.style.left = x + "px";
    ball.style.top = y + "px";

    if(p >= 1){
      clearInterval(timer);
      arrow.style.display = "none";
    }
  },16);
}

createButtons();
launchBall();
</script>

</body>
</html>
