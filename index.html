<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÊâìÁÇπÂà§Êñ≠„Éà„É¨„Éº„Éã„É≥„Ç∞</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.5s;
  touch-action: manipulation;
}

.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.hidden{display:none}

#top h1{margin-top:80px}
button{
  font-size:22px;
  padding:16px 30px;
  margin:12px;
  border:none;
  border-radius:12px;
  font-weight:bold;
}

#info{
  margin-top:20px;
  font-size:20px;
  text-align:center;
}
#result{
  font-size:42px;
  height:50px;
  margin:10px;
}

#gameArea{
  position:relative;
  width:100%;
  max-width:420px;
  flex:1;
  overflow:hidden;
}

#floor{
  position:absolute;
  bottom:80px;
  width:100%;
  height:4px;
  background:#555;
}

#ball{
  position:absolute;
  width:48px;
  height:48px;
  border-radius:50%;
  background:white;
  box-shadow:0 0 15px rgba(255,255,255,0.6);
}
</style>
</head>

<body>

<div id="top" class="screen">
  <h1>üèì ÊâìÁÇπÂà§Êñ≠„Éà„É¨„Éº„Éã„É≥„Ç∞</h1>
  <button onclick="startGame()">„Çπ„Çø„Éº„Éà</button>
</div>

<div id="game" class="screen hidden">
  <div id="info">
    ‚è± <span id="time">60</span>„ÄÄ
    ‚≠ê <span id="score">1.0</span>
  </div>
  <div id="result"></div>
  <div id="gameArea">
    <div id="floor"></div>
    <div id="ball"></div>
  </div>
</div>

<div id="end" class="screen hidden">
  <h2>ÁµÇ‰∫ÜÔºÅ</h2>
  <p id="finalScore" style="font-size:48px"></p>
  <button onclick="location.reload()">„Éà„ÉÉ„Éó„Å∏</button>
</div>

<script>
/* ===== „É¨„Éô„É´Ë®≠ÂÆö ===== */
const levels=[
  {g:0.20, vx:1.4, startY:0.20},
  {g:0.26, vx:1.7, startY:0.20},
  {g:0.35, vx:2.0, startY:0.20}, // ÁèæÂÆüÈáçÂäõ
  {g:0.35, vx:2.4, startY:0.18},
  {g:0.35, vx:2.8, startY:0.16},
  {g:0.35, vx:3.2, startY:0.14},
  {g:0.35, vx:3.6, startY:0.12}
];

const bgColors=[
  '#111','#1a2635','#1a3526',
  '#352a1a','#351a1a','#261a35','#351a35'
];

/* ===== Áä∂ÊÖã ===== */
let level=1, combo=0;
let time=60, timer=null;
let ball, area, floorY;
let x,y,vx,vy;
let bounced=0;
let active=false;

/* ===== ÁîªÈù¢Âà∂Âæ° ===== */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function updateBg(){
  document.body.style.background=
    bgColors[Math.min(level-1,bgColors.length-1)];
}

function updateScore(){
  document.getElementById('score').textContent=`${level}.${combo}`;
}

/* ===== ÈñãÂßã ===== */
function startGame(){
  show('game');
  level=1; combo=0; time=60;
  updateScore(); updateBg();
  document.getElementById('time').textContent=time;

  timer=setInterval(()=>{
    time--;
    document.getElementById('time').textContent=time;
    if(time<=0) endGame();
  },1000);

  spawnBall();
}

/* ===== „Éú„Éº„É´ÁîüÊàê ===== */
function spawnBall(){
  ball=document.getElementById('ball');
  area=document.getElementById('gameArea');
  floorY=area.clientHeight-80;

  const lv=levels[Math.min(level-1,levels.length-1)];

  x=20;
  y=area.clientHeight*lv.startY;
  vx=lv.vx;
  vy=0;
  bounced=0;
  active=true;

  ball.style.left=x+'px';
  ball.style.top=y+'px';

  requestAnimationFrame(updateBall);
}

/* ===== Áâ©ÁêÜ ===== */
function updateBall(){
  if(!active) return;

  const lv=levels[Math.min(level-1,levels.length-1)];
  vy+=lv.g;
  x+=vx;
  y+=vy;

  if(y>=floorY){
    y=floorY;
    vy*=-0.6;
    bounced++;
    if(bounced>=2){
      fail();
      return;
    }
  }

  ball.style.left=x+'px';
  ball.style.top=y+'px';

  if(x<area.clientWidth) requestAnimationFrame(updateBall);
}

/* ===== Âà§ÂÆö ===== */
ball?.addEventListener('pointerdown',()=>{});

document.getElementById('gameArea').addEventListener('pointerdown',e=>{
  if(!active) return;
  if(bounced===1){
    success();
  }
});

function success(){
  active=false;
  document.getElementById('result').textContent='„Äá';
  document.getElementById('result').style.color='#0f9';
  combo++;

  if(combo>=5){
    level++;
    combo=0;
    updateBg();
  }
  updateScore();
  setTimeout(()=>{document.getElementById('result').textContent=''; spawnBall();},600);
}

function fail(){
  active=false;
  document.getElementById('result').textContent='‚úñ';
  document.getElementById('result').style.color='#f00';
  combo=0;
  updateScore();
  setTimeout(()=>{document.getElementById('result').textContent=''; spawnBall();},600);
}

/* ===== ÁµÇ‰∫Ü ===== */
function endGame(){
  clearInterval(timer);
  show('end');
  document.getElementById('finalScore').textContent=`${level}.${combo}`;
}
</script>

</body>
</html>
