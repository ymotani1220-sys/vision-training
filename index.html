<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÊâìÁÇπÂà§Êñ≠„Éà„É¨„Éº„Éã„É≥„Ç∞</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.5s;
  touch-action: manipulation;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.hidden{display:none}

#info{margin-top:20px;font-size:20px}
#result{font-size:42px;height:50px;margin:8px}

#gameArea{
  position:relative;
  width:100%;
  max-width:420px;
  flex:1;
  overflow:hidden;
}

#floor{
  position:absolute;
  bottom:120px;
  width:100%;
  height:4px;
  background:#666;
}

#ball{
  position:absolute;
  width:48px;
  height:48px;
  border-radius:50%;
  background:#fff;
  box-shadow:0 0 15px rgba(255,255,255,0.6);
}
button{
  font-size:22px;
  padding:16px 30px;
  margin:12px;
  border:none;
  border-radius:12px;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="top" class="screen">
  <h1 style="margin-top:80px">üèì ÊâìÁÇπÂà§Êñ≠„Éà„É¨„Éº„Éã„É≥„Ç∞</h1>
  <button onclick="startGame()">„Çπ„Çø„Éº„Éà</button>
</div>

<div id="game" class="screen hidden">
  <div id="info">
    ‚è± <span id="time">60</span>„ÄÄ
    ‚≠ê <span id="score">1.0</span>
  </div>
  <div id="result"></div>
  <div id="gameArea">
    <div id="floor"></div>
    <div id="ball"></div>
  </div>
</div>

<div id="end" class="screen hidden">
  <h2>ÁµÇ‰∫ÜÔºÅ</h2>
  <p id="finalScore" style="font-size:48px"></p>
  <button onclick="location.reload()">„Éà„ÉÉ„Éó„Å∏</button>
</div>

<script>
/* ===== „É¨„Éô„É´Ë®≠ÂÆöÔºàÊ∏õË°∞„Å™„ÅóÔºâ ===== */
const levels=[
  {g:0.22, vx:1.2, vy:-5.0, startY:0.25},
  {g:0.26, vx:1.6, vy:-4.6, startY:0.30},
  {g:0.35, vx:2.2, vy:-4.0, startY:0.35}, // ÁèæÂÆü
  {g:0.35, vx:2.8, vy:-3.2, startY:0.42},
  {g:0.35, vx:3.4, vy:-2.6, startY:0.48},
  {g:0.35, vx:4.0, vy:-2.2, startY:0.52},
  {g:0.35, vx:4.6, vy:-1.8, startY:0.56}
];

const bgColors=[
  '#111','#1a2635','#1a3526',
  '#352a1a','#351a1a','#261a35','#351a35'
];

const RESTITUTION = 0.65; // ‚òÖÂÖ®„É¨„Éô„É´ÂÖ±ÈÄö‚òÖ

let level=1, combo=0;
let time=60, timer=null;
let x,y,vx,vy,bounced=0,active=false;
let area, floorY;

/* UI */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function updateBg(){
  document.body.style.background=bgColors[Math.min(level-1,6)];
}
function updateScore(){
  document.getElementById('score').textContent=`${level}.${combo}`;
}

/* ÈñãÂßã */
function startGame(){
  show('game');
  level=1; combo=0; time=60;
  updateScore(); updateBg();
  document.getElementById('time').textContent=time;

  timer=setInterval(()=>{
    time--;
    document.getElementById('time').textContent=time;
    if(time<=0) endGame();
  },1000);

  spawnBall();
}

/* „Éú„Éº„É´ÁîüÊàê */
function spawnBall(){
  const lv=levels[Math.min(level-1,levels.length-1)];
  area=document.getElementById('gameArea');
  floorY=document.getElementById('floor').offsetTop;

  x=20;
  y=area.clientHeight*lv.startY;
  vx=lv.vx;
  vy=lv.vy;
  bounced=0;
  active=true;

  const ball=document.getElementById('ball');
  ball.style.left=x+'px';
  ball.style.top=y+'px';

  requestAnimationFrame(updateBall);
}

/* Áâ©ÁêÜ */
function updateBall(){
  if(!active) return;
  const lv=levels[Math.min(level-1,levels.length-1)];

  vy+=lv.g;
  x+=vx;
  y+=vy;

  if(y>=floorY){
    y=floorY;
    vy*=-RESTITUTION;
    bounced++;
    if(bounced>=2){
      fail();
      return;
    }
  }

  const ball=document.getElementById('ball');
  ball.style.left=x+'px';
  ball.style.top=y+'px';

  if(x<area.clientWidth+60) requestAnimationFrame(updateBall);
}

/* Âà§ÂÆö */
document.getElementById('gameArea').addEventListener('pointerdown',()=>{
  if(active && bounced===1){
    success();
  }
});

function success(){
  active=false;
  document.getElementById('result').textContent='„Äá';
  document.getElementById('result').style.color='#0f9';
  combo++;
  if(combo>=5){ level++; combo=0; updateBg(); }
  updateScore();
  setTimeout(reset,600);
}

function fail(){
  active=false;
  document.getElementById('result').textContent='‚úñ';
  document.getElementById('result').style.color='#f00';
  combo=0;
  updateScore();
  setTimeout(reset,600);
}

function reset(){
  document.getElementById('result').textContent='';
  spawnBall();
}

/* ÁµÇ‰∫Ü */
function endGame(){
  clearInterval(timer);
  show('end');
  document.getElementById('finalScore').textContent=`${level}.${combo}`;
}
</script>

</body>
</html>
