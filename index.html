<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>横回転判断ゲーム</title>

<style>
body{
  margin:0;
  background:#1b5e20;
  display:flex;
  justify-content:center;
  font-family:sans-serif;
}

#game{
  width:360px;
  height:640px;
  background:#2e7d32;
  color:#fff;
  position:relative;
  overflow:hidden;
}

/* 上部 */
#top{
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
}

/* 卓球台 */
#table-wrap{
  position:relative;
  height:480px;
}

#table{
  position:absolute;
  left:50%;
  top:80px;
  transform:translateX(-50%);
  width:220px;
  height:420px;
  background:#1565c0;
  border:4px solid #fff;
  box-sizing:border-box;
}

#line-center{
  position:absolute;
  left:50%;
  top:0;
  width:2px;
  height:100%;
  background:#fff;
  transform:translateX(-50%);
}

#net{
  position:absolute;
  top:50%;
  left:0;
  width:100%;
  height:4px;
  background:#fff;
}

/* ボール */
#ball{
  position:absolute;
  width:24px;
  height:24px;
  border-radius:50%;
  background:#fff;
  display:none;
}

/* 回転矢印 */
.spin-arrow{
  position:absolute;
  font-size:80px;
  font-weight:bold;
  color:#ffeb3b;
}

/* ボタン */
#buttons{
  position:absolute;
  bottom:12px;
  width:100%;
  display:flex;
  justify-content:space-around;
}

.col{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.btn{
  width:64px;
  height:36px;
  background:#eee;
  border-radius:50%;
  position:relative;
}

.btn::after{
  content:"";
  position:absolute;
  width:40px;
  height:3px;
  background:#000;
  top:50%;
  left:50%;
  transform-origin:center;
}

.left::after{ transform:translate(-50%,-50%) rotate(-30deg); }
.straight::after{ transform:translate(-50%,-50%) rotate(0deg); }
.right::after{ transform:translate(-50%,-50%) rotate(30deg); }

.judge{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:28px;
  font-weight:bold;
}
.correct{ color:#00e676; }
.wrong{ color:#ff5252; }
</style>
</head>

<body>
<div id="game">

  <div id="top">
    <div>TIME</div>
    <div id="score">SCORE 0</div>
  </div>

  <div id="table-wrap">
    <div id="table">
      <div id="line-center"></div>
      <div id="net"></div>
    </div>
    <div id="ball"></div>
  </div>

  <div id="buttons"></div>

</div>

<script>
const table = document.getElementById("table");
const ball = document.getElementById("ball");
const buttons = document.getElementById("buttons");
const scoreEl = document.getElementById("score");

let score = 0;
let correctSpin = 0;
let arrivalCourse = 1;

const BALL = 24;

/*
spin（プレイヤー目線）
0 = 反時計回り → 右に曲がる
1 = 直進
2 = 時計回り → 左に曲がる
*/
const spinMap = { left:2, straight:1, right:0 };

/* ボタン生成 */
["fore","middle","back"].forEach((_,col)=>{
  const c=document.createElement("div");
  c.className="col";
  ["left","straight","right"].forEach(a=>{
    const b=document.createElement("div");
    b.className="btn "+a;
    b.dataset.col=col;
    b.dataset.angle=a;
    b.onclick=()=>judge(b);
    c.appendChild(b);
  });
  buttons.appendChild(c);
});

/* 正しい打ち出しX */
function getServeX(course){
  const rect = table.getBoundingClientRect();
  const left = rect.left;
  const width = rect.width;

  if(course === 0){
    return left + BALL;
  }
  if(course === 1){
    return left + width/2 - BALL/2;
  }
  return left + width - BALL*2;
}

function calcArrival(start, spin){
  if(spin===0) return Math.min(2,start+1);
  if(spin===2) return Math.max(0,start-1);
  return start;
}

function showArrow(x,y,spin){
  if(spin===1) return;
  const a=document.createElement("div");
  a.className="spin-arrow";
  a.textContent= spin===0 ? "⟲" : "⟳";
  a.style.left = x - 28 + "px";
  a.style.top = y - 80 + "px";
  document.body.appendChild(a);
  setTimeout(()=>a.remove(),1000);
}

function serve(){
  document.querySelectorAll(".judge").forEach(j=>j.remove());

  const start = Math.floor(Math.random()*3);
  correctSpin = Math.floor(Math.random()*3);
  arrivalCourse = calcArrival(start, correctSpin);

  let x = getServeX(start);
  let y = table.offsetTop + 10;

  ball.style.display="block";
  showArrow(x,y,correctSpin);

  const curve = [2,0,-2][correctSpin];

  const timer = setInterval(()=>{
    y += 2;
    x += curve;
    ball.style.left = x + "px";
    ball.style.top = y + "px";

    if(y > table.offsetTop + table.offsetHeight - 30){
      clearInterval(timer);
      ball.style.display="none";
      setTimeout(serve,800);
    }
  },30);
}

function judge(btn){
  if(Number(btn.dataset.col) !== arrivalCourse) return;

  const spin = spinMap[btn.dataset.angle];
  const j = document.createElement("div");
  j.className="judge";

  if(spin === correctSpin){
    j.textContent="○";
    j.classList.add("correct");
    score+=10;
    scoreEl.textContent="SCORE "+score;
  }else{
    j.textContent="×";
    j.classList.add("wrong");
  }
  btn.appendChild(j);
}

serve();
</script>
</body>
</html>
