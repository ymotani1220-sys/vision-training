<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - åˆ¹é‚£ver</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.8s ease;
  overflow: hidden;
  touch-action: manipulation;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none}
button{font-size:20px;padding:16px 28px;margin:10px;cursor:pointer;border-radius:12px;border:none;background:#eee;color:#111;font-weight:bold;}

/* ===== å…±é€šUI ===== */
.info-panel { font-size: 20px; margin-bottom: 10px; text-align: center; line-height: 1.5; }
.score-highlight { font-size: 28px; color: #ffeb3b; font-weight: bold; }

/* ===== å›è»¢åˆ¤æ–­ ===== */
#spinGame{position:relative;width:320px;height:320px}
#resultText{position:absolute;top:-40px;left:50%;transform:translateX(-50%);
  font-size:40px;font-weight:bold;height:45px}
#center{
  position:absolute;top:50%;left:50%;
  width:80px;height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;background:#fff;
  display:flex;justify-content:center;align-items:center;
  box-shadow: 0 0 15px rgba(255,255,255,0.5);
}
#arrow{font-size:50px;font-weight:900;color:#f33;transition: transform 0.15s ease-out;}
.spin-btn{
  position:absolute;width:56px;height:56px;
  border-radius:50%;background:#444;border:3px solid #fff;
}
.spin-btn.active{background:#0f9;box-shadow: 0 0 20px #0f9;}

/* ===== ç¬é–“åˆ¤æ–­ ===== */
.arrow-display{font-size:130px;margin:5px;height:140px;line-height:140px;}
#feedback{font-size:45px;height:55px;font-weight:bold;}
.flash-controls button{background:#555;color:white;min-width: 90px;font-size:35px;}
</style>
</head>

<body>

<div id="top" class="screen">
  <h1 style="margin-bottom:30px;">ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startSpin()">å›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
  <button onclick="startFlash()">ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
</div>

<div id="spinScreen" class="screen hidden">
  <div class="info-panel">
    â± <span id="spinTimeDisp">60</span><br>
    ã‚¹ã‚³ã‚¢ï¼š<span id="spinScoreDisp" class="score-highlight">1.0</span>
  </div>
  <div id="spinGame">
    <div id="resultText"></div>
    <div id="center"><div id="arrow">â†‘</div></div>
  </div>
</div>

<div id="flashScreen" class="screen hidden">
  <div id="flashGame" style="text-align:center;">
    <div class="info-panel">
      â± <span id="flashTimeDisp">60</span><br>
      ã‚¹ã‚³ã‚¢ï¼š<span id="flashScoreDisp" class="score-highlight">1.0</span>
    </div>
    <div id="flashArrow" class="arrow-display"></div>
    <div id="feedback"></div>
    <div class="flash-controls">
      <button onclick="answerFlash('left')">â†</button>
      <button onclick="answerFlash('up')">â†‘</button>
      <button onclick="answerFlash('right')">â†’</button>
    </div>
  </div>
</div>

<div id="end" class="screen hidden">
  <h2 style="font-size:32px;">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµ‚äº†ï¼</h2>
  <p id="finalScore" class="score-highlight" style="font-size:48px; margin:10px 0;"></p>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== å…±é€šè¨­å®š ===== */
const bgColors=['#111','#1a2635','#1a3526','#352a1a','#351a1a','#261a35','#351a35','#4a148c','#004d40'];
// å…±é€šã®è¡¨ç¤ºãƒ»åˆ¶é™æ™‚é–“è¨­å®šï¼ˆLv1ã€œLv8+ï¼‰
const speedSettings=[1500, 1200, 1000, 850, 700, 550, 450, 350];

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function updateBg(lvl){
  document.body.style.background = bgColors[Math.min(lvl-1, bgColors.length-1)];
}

/* ================= å›è»¢åˆ¤æ–­ (Spin) ================= */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=125, center=160;

let rackets=[], correctIdx=0, answeredSpin=false;
let spinLvl=1, spinCombo=0, spinTimeLeft=60, spinTimer=null, spinNextTimer=null;

const spinArea = document.getElementById('spinGame');
anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-28+'px';
  b.style.top =center+radius*Math.sin(a)-28+'px';
  b.onclick=()=>judgeSpin(i===correctIdx);
  rackets.push(b);
  spinArea.appendChild(b);
});

function startSpin(){
  show('spinScreen');
  spinLvl=1; spinCombo=0; spinTimeLeft=60;
  updateSpinScore(); updateBg(1);
  if(spinTimer) clearInterval(spinTimer);
  spinTimer=setInterval(()=>{
    spinTimeLeft--;
    document.getElementById('spinTimeDisp').textContent=spinTimeLeft;
    if(spinTimeLeft<=0) endSpin();
  },1000);
  nextSpin();
}

function nextSpin(){
  if(spinTimeLeft<=0) return;
  answeredSpin=false;
  document.getElementById('resultText').textContent='';
  rackets.forEach(r=>r.classList.remove('active'));
  
  correctIdx=Math.floor(Math.random()*8);
  document.getElementById('arrow').style.transform=`rotate(${anglesDeg[correctIdx]+90}deg)`;
  rackets[correctIdx].classList.add('active');
  
  if(spinNextTimer) clearTimeout(spinNextTimer);
  const currentSpeed = speedSettings[Math.min(spinLvl-1, speedSettings.length-1)];
  spinNextTimer=setTimeout(()=>judgeSpin(false), currentSpeed);
}

function judgeSpin(ok){
  if(answeredSpin || spinTimeLeft<=0) return;
  answeredSpin=true;
  clearTimeout(spinNextTimer);
  rackets.forEach(r=>r.classList.remove('active'));

  const resEl = document.getElementById('resultText');
  if(ok){
    resEl.textContent='ã€‡'; resEl.style.color='#0f9'; spinCombo++;
    if(spinCombo >= 5){ spinLvl++; spinCombo=0; updateBg(spinLvl); }
  } else {
    resEl.textContent='âœ–'; resEl.style.color='#f00'; spinCombo=0;
  }
  updateSpinScore();
  setTimeout(nextSpin, 600);
}

function updateSpinScore(){
  document.getElementById('spinScoreDisp').textContent = `${spinLvl}.${spinCombo}`;
}

function endSpin(){
  clearInterval(spinTimer);
  clearTimeout(spinNextTimer);
  document.getElementById('finalScore').textContent = `${spinLvl}.${spinCombo}`;
  show('end');
}

/* ================= ç¬é–“åˆ¤æ–­ (Flash) ================= */
const arrows=['left','up','right'];
const icons={left:'â†',up:'â†‘',right:'â†’'};

let flashLvl=1, flashCombo=0, flashTimeLeft=60, flashTimer=null, flashNextTimer=null, currentDir='', answeredFlash=false;

function startFlash(){
  show('flashScreen');
  flashLvl=1; flashCombo=0; flashTimeLeft=60;
  updateFlashScore(); updateBg(1);
  if(flashTimer) clearInterval(flashTimer);
  flashTimer=setInterval(()=>{
    flashTimeLeft--;
    document.getElementById('flashTimeDisp').textContent=flashTimeLeft;
    if(flashTimeLeft<=0) endFlash();
  },1000);
  nextFlash();
}

function nextFlash(){
  if(flashTimeLeft<=0) return;
  answeredFlash=false;
  document.getElementById('feedback').textContent='';
  
  currentDir=arrows[Math.floor(Math.random()*3)];
  document.getElementById('flashArrow').textContent=icons[currentDir];
  
  if(flashNextTimer) clearTimeout(flashNextTimer);
  const currentSpeed = speedSettings[Math.min(flashLvl-1, speedSettings.length-1)];
  // åˆ¶é™æ™‚é–“å†…ã«ç­”ãˆã‚‰ã‚Œãªã‘ã‚Œã°ãƒŸã‚¹ï¼ˆjudgeFlashã‚’falseã§å‘¼ã¶ï¼‰
  flashNextTimer=setTimeout(()=>judgeFlash(null), currentSpeed);
}

function answerFlash(a){
  if(answeredFlash || flashTimeLeft<=0) return;
  judgeFlash(a === currentDir);
}

function judgeFlash(ok){
  if(answeredFlash || flashTimeLeft<=0) return;
  answeredFlash=true;
  clearTimeout(flashNextTimer);
  
  // çŸ¢å°ã‚’æ¶ˆã™ï¼ˆåˆ¹é‚£ã®ä»•æ§˜ï¼‰
  document.getElementById('flashArrow').textContent='';
  
  const fb = document.getElementById('feedback');
  if(ok === true){
    fb.textContent='ã€‡'; fb.style.color='#0f9'; flashCombo++;
    if(flashCombo >= 5){ flashLvl++; flashCombo=0; updateBg(flashLvl); }
  } else {
    fb.textContent='âœ–'; fb.style.color='#f00'; flashCombo=0;
  }
  updateFlashScore();
  // æ¬¡ã®å•é¡Œã¾ã§ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ï¼ˆå°‘ã—ã‚†ã¨ã‚Šã‚’æŒãŸã›ã‚‹ï¼‰
  setTimeout(nextFlash, 600);
}

function updateFlashScore(){
  document.getElementById('flashScoreDisp').textContent = `${flashLvl}.${flashCombo}`;
}

function endFlash(){
  clearInterval(flashTimer);
  clearTimeout(flashNextTimer);
  document.getElementById('finalScore').textContent = `${flashLvl}.${flashCombo}`;
  show('end');
}

function backTop(){
  updateBg(1);
  show('top');
}
</script>

</body>
</html>
