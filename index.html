<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å“çƒ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    font-family: sans-serif;
    text-align: center;
    user-select: none;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transition: background-image 0.5s ease;
  }

  .overlay {
    background: rgba(255,255,255,0.85);
    min-height: 100vh;
    padding-top: 10px;
  }

  h1 { font-size: 24px; }

  button {
    font-size: 20px;
    padding: 10px 18px;
    margin: 6px;
  }

  #target {
    font-size: 90px;
    margin: 20px;
    display: none;
  }

  #timer {
    font-size: 22px;
    font-weight: bold;
  }

  #result { font-size: 22px; }
  #combo { font-size: 24px; color: red; }
  #levelup { font-size: 26px; color: green; }
</style>
</head>

<body>

<div class="overlay">

<h1>ğŸ“ å“çƒ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>

<p id="levelDisplay">Lv1</p>
<p id="timer">â± 40ç§’</p>

<button onclick="startGame()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

<div id="target"></div>

<div>
  <button onclick="judge('â†')">â†</button>
  <button onclick="judge('â†‘')">â†‘</button>
  <button onclick="judge('â†’')">â†’</button>
</div>

<div id="result"></div>
<div id="combo"></div>
<div id="levelup"></div>

</div>

<script>
let level = 1;
let answer = "";
let visible = false;
let combo = 0;

let gameTime = 40;
let timerInterval = null;
let gameActive = false;

// ãƒ¬ãƒ™ãƒ«è¨­å®š
const levelSettings = {
  1:{time:1500,choices:["â†","â†’"], coolOk:1500, coolNg:2000},
  2:{time:1200,choices:["â†","â†’"], coolOk:1300, coolNg:1800},
  3:{time:900, choices:["â†","â†’"], coolOk:1100, coolNg:1600},
  4:{time:700, choices:["â†","â†’"], coolOk:900,  coolNg:1400},
  5:{time:550, choices:["â†","â†‘","â†’"], coolOk:700,  coolNg:1200},
  6:{time:400, choices:["â†","â†‘","â†’"], coolOk:500,  coolNg:1000},
  7:{time:280, choices:["â†","â†‘","â†’"], coolOk:350,  coolNg:800}
};

// ğŸ”Š Audio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, dur){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = freq;
  o.connect(g);
  g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
  o.stop(audioCtx.currentTime + dur);
}

// ğŸ¨ èƒŒæ™¯
function updateBackground(){
  document.body.style.backgroundImage =
    `url('images/bg_lv${level}.png')`;
}

function updateLevelDisplay(){
  document.getElementById("levelDisplay").textContent = "Lv" + level;
  updateBackground();
}

// â± ã‚¿ã‚¤ãƒãƒ¼
function startTimer(){
  gameTime = 40;
  document.getElementById("timer").textContent = "â± 40ç§’";

  timerInterval = setInterval(() => {
    gameTime--;
    document.getElementById("timer").textContent =
      "â± " + gameTime + "ç§’";

    if(gameTime <= 0){
      endGame();
    }
  }, 1000);
}

function endGame(){
  clearInterval(timerInterval);
  gameActive = false;
  visible = false;
  document.getElementById("target").style.display = "none";
  document.getElementById("result").textContent =
    "â± çµ‚äº†ï¼ åˆ°é”ãƒ¬ãƒ™ãƒ«ï¼šLv" + level;
  document.getElementById("combo").textContent = "";
  document.getElementById("levelup").textContent = "";
  playSound(300, 0.6);
}

// â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ
function startGame(){
  audioCtx.resume();
  clearInterval(timerInterval);

  level = 1;
  combo = 0;
  gameActive = true;

  document.getElementById("result").textContent = "";
  document.getElementById("combo").textContent = "";
  document.getElementById("levelup").textContent = "";

  updateLevelDisplay();
  startTimer();

  setTimeout(showTarget, 800);
}

function showTarget(){
  if(!gameActive) return;

  const setting = levelSettings[level];
  answer = setting.choices[
    Math.floor(Math.random()*setting.choices.length)
  ];

  const t = document.getElementById("target");
  t.textContent = answer;
  t.style.display = "block";
  visible = true;

  setTimeout(()=>{
    if(!visible || !gameActive) return;
    visible = false;
    combo = 0;
    t.style.display = "none";
    playSound(150,0.3);
    document.getElementById("result").textContent="âŒ é…ã„ï¼";
    document.getElementById("combo").textContent="";
  }, setting.time);
}

function judge(select){
  if(!visible || !gameActive) return;

  visible = false;
  document.getElementById("target").style.display="none";

  const setting = levelSettings[level];

  if(select===answer){
    combo++;
    playSound(600,0.15);
    document.getElementById("result").textContent="â­• æ­£è§£ï¼";
    document.getElementById("combo").textContent=
      combo+" é€£ç¶šæ­£è§£";

    if(combo>=5){
      combo=0;
      if(level<7){
        level++;
        playSound(1000,0.4);
        document.getElementById("levelup").textContent =
          "ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv"+level;
        updateLevelDisplay();
      }
    }

    setTimeout(showTarget, setting.coolOk);

  }else{
    combo=0;
    playSound(200,0.3);
    document.getElementById("result").textContent="âŒ ãƒŸã‚¹";
    document.getElementById("combo").textContent="";
    setTimeout(showTarget, setting.coolNg);
  }
}

updateLevelDisplay();
</script>

</body>
</html>
