<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - å…¨ä¸–ä»£å¯¾å¿œver</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.8s ease; /* å¤‰åŒ–ã‚’ã‚ˆã‚Šç©ã‚„ã‹ã« */
  overflow: hidden;
  touch-action: manipulation; /* ã‚¹ãƒãƒ›ã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ é˜²æ­¢ */
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none}
button{font-size:20px;padding:16px 28px;margin:10px;cursor:pointer;border-radius:12px;border:none;background:#eee;color:#111;font-weight:bold;}

/* ===== å›è»¢åˆ¤æ–­ ===== */
#spinGame{position:relative;width:320px;height:320px}
#spinInfo{position:absolute;top:-90px;width:100%;text-align:center;font-size:18px;}
#resultText{position:absolute;top:-35px;left:50%;transform:translateX(-50%);
  font-size:40px;font-weight:bold;height:45px}
#center{
  position:absolute;top:50%;left:50%;
  width:80px;height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;background:#fff;
  display:flex;justify-content:center;align-items:center;
  box-shadow: 0 0 15px rgba(255,255,255,0.5);
}
#arrow{font-size:50px;font-weight:900;color:#f33;transition: transform 0.15s ease-out;}
.spin-btn{
  position:absolute;width:56px;height:56px;
  border-radius:50%;background:#444;border:3px solid #fff;
}
.spin-btn.active{background:#0f9;box-shadow: 0 0 20px #0f9;}

/* ===== ç¬é–“åˆ¤æ–­ ===== */
.arrow-display{font-size:130px;margin:10px;height:150px;line-height:150px;}
#feedback{font-size:45px;height:55px;font-weight:bold;}
.flash-controls button{background:#555;color:white;min-width: 90px;font-size:35px;margin:5px;}
</style>
</head>

<body>

<div id="top" class="screen">
  <h1 style="margin-bottom:30px;">ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startSpin()">å›è»¢åˆ¤æ–­ (ã‚†ã£ãŸã‚Šã€œ)</button>
  <button onclick="startFlash()">ç¬é–“åˆ¤æ–­ (ã‚†ã£ãŸã‚Šã€œ)</button>
</div>

<div id="spinScreen" class="screen hidden">
  <div id="spinGame">
    <div id="spinInfo">
      Lv <span id="spinLvDisp">1</span> | ğŸ”¥ <span id="spinComboDisp">0</span> | â± <span id="spinTimeDisp">60</span>
    </div>
    <div id="resultText"></div>
    <div id="center"><div id="arrow">â†‘</div></div>
  </div>
</div>

<div id="flashScreen" class="screen hidden">
  <div id="flashGame" style="text-align:center;">
    <div style="font-size:18px; margin-bottom:10px;">â± <span id="flashTimeDisp">60</span></div>
    <div style="font-size:18px;">Lv <span id="flashLvDisp">1</span> | ğŸ”¥ <span id="flashComboDisp">0</span></div>
    <div id="flashArrow" class="arrow-display"></div>
    <div id="feedback"></div>
    <div class="flash-controls">
      <button onclick="answerFlash('left')">â†</button>
      <button onclick="answerFlash('up')">â†‘</button>
      <button onclick="answerFlash('right')">â†’</button>
    </div>
  </div>
</div>

<div id="end" class="screen hidden">
  <h2 style="font-size:32px;">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h2>
  <p id="finalScore" style="font-size:24px;"></p>
  <button onclick="backTop()">ã‚‚ã†ä¸€åº¦ã‚ãã¶</button>
</div>

<script>
/* ===== å…±é€š ===== */
const bgColors=['#111','#1a2635','#1a3526','#352a1a','#351a1a','#261a35','#351a35'];
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function updateBg(lvl){
  document.body.style.background = bgColors[Math.min(lvl-1, bgColors.length-1)];
}

/* ================= å›è»¢åˆ¤æ–­ (Spin) ================= */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=125, center=160;
// ãƒ¬ãƒ™ãƒ«ã”ã¨ã®åˆ¶é™æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
const spinShowTimes=[1500, 1200, 1000, 850, 700, 550, 400];

let rackets=[], correctIdx=0, answered=false;
let spinLvl=1, spinCombo=0, spinTimeLeft=60, spinTimer=null, spinNextTimer=null;

const spinArea = document.getElementById('spinGame');
anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-28+'px';
  b.style.top =center+radius*Math.sin(a)-28+'px';
  b.onclick=()=>judgeSpin(i===correctIdx);
  rackets.push(b);
  spinArea.appendChild(b);
});

function startSpin(){
  show('spinScreen');
  spinLvl=1; spinCombo=0; spinTimeLeft=60;
  updateSpinUI(); updateBg(1);
  if(spinTimer) clearInterval(spinTimer);
  spinTimer=setInterval(()=>{
    spinTimeLeft--;
    document.getElementById('spinTimeDisp').textContent=spinTimeLeft;
    if(spinTimeLeft<=0) endSpin();
  },1000);
  nextSpin();
}

function nextSpin(){
  if(spinTimeLeft<=0) return;
  answered=false;
  document.getElementById('resultText').textContent='';
  rackets.forEach(r=>r.classList.remove('active'));
  
  correctIdx=Math.floor(Math.random()*8);
  document.getElementById('arrow').style.transform=`rotate(${anglesDeg[correctIdx]+90}deg)`;
  rackets[correctIdx].classList.add('active');
  
  if(spinNextTimer) clearTimeout(spinNextTimer);
  // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦å¾…ã¡æ™‚é–“ã‚’å¤‰ãˆã‚‹
  spinNextTimer=setTimeout(()=>judgeSpin(false), spinShowTimes[spinLvl-1]);
}

function judgeSpin(ok){
  if(answered || spinTimeLeft<=0) return;
  answered=true;
  clearTimeout(spinNextTimer);
  rackets.forEach(r=>r.classList.remove('active'));

  const resEl = document.getElementById('resultText');
  if(ok){
    resEl.textContent='ã€‡'; resEl.style.color='#0f9'; spinCombo++;
    if(spinCombo >= 5 && spinLvl < 7){
      spinLvl++; spinCombo=0;
      updateBg(spinLvl);
    }
  } else {
    resEl.textContent='âœ–'; resEl.style.color='#f00'; spinCombo=0;
  }
  updateSpinUI();
  setTimeout(nextSpin, 600);
}

function updateSpinUI(){
  document.getElementById('spinLvDisp').textContent=spinLvl;
  document.getElementById('spinComboDisp').textContent=spinCombo;
}

function endSpin(){
  clearInterval(spinTimer);
  clearTimeout(spinNextTimer);
  document.getElementById('finalScore').textContent=`å›è»¢åˆ¤æ–­ï¼šãƒ¬ãƒ™ãƒ« ${spinLvl}`;
  show('end');
}

/* ================= ç¬é–“åˆ¤æ–­ (Flash) ================= */
const arrows=['left','up','right'];
const icons={left:'â†',up:'â†‘',right:'â†’'};
// ãƒ¬ãƒ™ãƒ«ã”ã¨ã®æ¬¡ã®çŸ¢å°ã¾ã§ã®å¾…ã¡æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
const flashWaitTimes=[400, 350, 300, 250, 200, 150, 100];

let flashLvl=1, flashCombo=0, flashTimeLeft=60, flashTimer=null, currentDir='';

function startFlash(){
  show('flashScreen');
  flashLvl=1; flashCombo=0; flashTimeLeft=60;
  updateFlashUI(); updateBg(1);
  if(flashTimer) clearInterval(flashTimer);
  flashTimer=setInterval(()=>{
    flashTimeLeft--;
    document.getElementById('flashTimeDisp').textContent=flashTimeLeft;
    if(flashTimeLeft<=0) endFlash();
  },1000);
  nextFlash();
}

function nextFlash(){
  if(flashTimeLeft<=0) return;
  currentDir=arrows[Math.floor(Math.random()*3)];
  document.getElementById('flashArrow').textContent=icons[currentDir];
}

function answerFlash(a){
  if(flashTimeLeft<=0) return;
  const fb = document.getElementById('feedback');
  if(a===currentDir){
    fb.textContent='ã€‡'; fb.style.color='#0f9'; flashCombo++;
    if(flashCombo >= 5 && flashLvl < 7){
      flashLvl++; flashCombo=0;
      updateBg(flashLvl);
    }
  } else {
    fb.textContent='âœ–'; fb.style.color='#f00'; flashCombo=0;
  }
  updateFlashUI();
  // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦æ¬¡ã®å•é¡Œã¾ã§ã®æ™‚é–“ã‚’å¤‰ãˆã‚‹ï¼ˆãƒ†ãƒ³ãƒã‚¢ãƒƒãƒ—ï¼‰
  setTimeout(()=>{fb.textContent=''; nextFlash();}, flashWaitTimes[flashLvl-1]);
}

function updateFlashUI(){
  document.getElementById('flashLvDisp').textContent=flashLvl;
  document.getElementById('flashComboDisp').textContent=flashCombo;
}

function endFlash(){
  clearInterval(flashTimer);
  document.getElementById('finalScore').textContent=`ç¬é–“åˆ¤æ–­ï¼šãƒ¬ãƒ™ãƒ« ${flashLvl}`;
  show('end');
}

/* ===== æˆ»ã‚‹ ===== */
function backTop(){
  updateBg(1);
  show('top');
}
</script>

</body>
</html>
