<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - è¦šé†’ver</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.4s;
  overflow: hidden;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.hidden{display:none}
button{font-size:20px;padding:14px 26px;margin:10px;cursor:pointer;border-radius:8px;border:none;}

/* ===== ãƒˆãƒƒãƒ— ===== */
#top h1{font-size:22px}

/* ===== å›è»¢åˆ¤æ–­ ===== */
#spinGame{position:relative;width:320px;height:320px}
#spinInfo{position:absolute;top:-90px;width:100%;text-align:center;line-height:1.6}
#resultText{position:absolute;top:-35px;left:50%;transform:translateX(-50%);
  font-size:34px;font-weight:bold;height:40px}
#center{
  position:absolute;top:50%;left:50%;
  width:80px;height:80px;
  transform:translate(-50%,-50%);
  border-radius:50%;background:#fff;
  display:flex;justify-content:center;align-items:center
}
#arrow{font-size:46px;font-weight:900;color:#f33;transition: transform 0.1s;}
.spin-btn{
  position:absolute;width:50px;height:50px;
  border-radius:50%;background:#444;border:2px solid #fff;
}
.spin-btn.active{background:#0f9;box-shadow: 0 0 15px #0f9;}

/* ===== ç¬é–“åˆ¤æ–­ ===== */
#flashGame{text-align: center;}
#flashGame .arrow-display{font-size:100px;margin:20px;height:120px;line-height:120px}
#feedback{font-size:40px;height:50px}
.flash-controls button{background:#333;color:white;min-width: 60px;}
</style>
</head>

<body>

<div id="top" class="screen">
  <h1>ğŸ“ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startSpin()">å›è»¢åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
  <button onclick="startFlash()">ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
</div>

<div id="spinScreen" class="screen hidden">
  <div id="spinGame">
    <div id="spinInfo">
      Lv <span id="spinLvDisp">1</span>
      ğŸ”¥ <span id="spinComboDisp">0</span>
      â± <span id="spinTimeDisp">60</span>
    </div>
    <div id="resultText"></div>
    <div id="center"><div id="arrow">â†‘</div></div>
  </div>
</div>

<div id="flashScreen" class="screen hidden">
  <div id="flashGame">
    â± <span id="flashTimeDisp">60</span><br>
    Lv <span id="flashLvDisp">1</span> ğŸ”¥ <span id="flashComboDisp">0</span><br>
    <div id="flashArrow" class="arrow-display"></div>
    <div id="feedback"></div>
    <div class="flash-controls">
      <button onclick="answerFlash('left')">â†</button>
      <button onclick="answerFlash('up')">â†‘</button>
      <button onclick="answerFlash('right')">â†’</button>
    </div>
  </div>
</div>

<div id="end" class="screen hidden">
  <h2>ğŸ‰ çµ‚äº†</h2>
  <p id="finalScore"></p>
  <button onclick="backTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>

<script>
/* ===== å…±é€šãƒ»å®šæ•° ===== */
const bgColors=['#111','#0b1a2a','#102a1c','#2a1c10','#2a1010','#1a102a','#2a002a'];
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* ================= å›è»¢åˆ¤æ–­ ================= */
const anglesDeg=[-90,-45,0,45,90,135,180,225];
const anglesRad=anglesDeg.map(a=>a*Math.PI/180);
const radius=120, center=160;
const showTimes=[1200,1000,850,700,600,500,400];

let rackets=[],correctIdx=0,answered=false;
let spinLvl=1,spinCombo=0,spinTimeLeft=60,spinTimer=null,nextTaskTimer=null;

// ãƒœã‚¿ãƒ³ã®å‹•çš„ç”Ÿæˆ
const gameContainer = document.getElementById('spinGame');
anglesRad.forEach((a,i)=>{
  const b=document.createElement('button');
  b.className='spin-btn';
  b.style.left=center+radius*Math.cos(a)-25+'px';
  b.style.top =center+radius*Math.sin(a)-25+'px';
  b.onclick=()=>judgeSpin(i===correctIdx);
  rackets.push(b);
  gameContainer.appendChild(b);
});

function startSpin(){
  show('spinScreen');
  spinLvl=1;spinCombo=0;spinTimeLeft=60;
  updateSpinUI();updateBg(spinLvl);
  if(spinTimer) clearInterval(spinTimer);
  spinTimer=setInterval(()=>{
    spinTimeLeft--;
    document.getElementById('spinTimeDisp').textContent=spinTimeLeft;
    if(spinTimeLeft<=0) endSpin();
  },1000);
  nextSpin();
}

function nextSpin(){
  if(spinTimeLeft<=0) return;
  answered=false;
  document.getElementById('resultText').textContent='';
  rackets.forEach(r=>r.classList.remove('active'));
  
  correctIdx=Math.floor(Math.random()*8);
  document.getElementById('arrow').style.transform=`rotate(${anglesDeg[correctIdx]+90}deg)`;
  rackets[correctIdx].classList.add('active');
  
  if(nextTaskTimer) clearTimeout(nextTaskTimer);
  nextTaskTimer=setTimeout(()=>judgeSpin(false), showTimes[spinLvl-1]);
}

function judgeSpin(ok){
  if(answered || spinTimeLeft<=0) return;
  answered=true;
  clearTimeout(nextTaskTimer);
  rackets.forEach(r=>r.classList.remove('active'));

  const resEl = document.getElementById('resultText');
  if(ok){
    resEl.textContent='ã€‡';resEl.style.color='#0f9';spinCombo++;
    if(spinCombo>=5 && spinLvl<7){spinLvl++;spinCombo=0;updateBg(spinLvl);}
  }else{
    resEl.textContent='âœ–';resEl.style.color='#f00';spinCombo=0;
  }
  updateSpinUI();
  setTimeout(nextSpin, 500);
}

function updateSpinUI(){
  document.getElementById('spinLvDisp').textContent=spinLvl;
  document.getElementById('spinComboDisp').textContent=spinCombo;
}

function endSpin(){
  clearInterval(spinTimer);
  clearTimeout(nextTaskTimer);
  document.getElementById('finalScore').textContent=`å›è»¢åˆ¤æ–­ ãƒ¬ãƒ™ãƒ«ï¼š${spinLvl} ã‚³ãƒ³ãƒœï¼š${spinCombo}`;
  show('end');
}

/* ================= ç¬é–“åˆ¤æ–­ ================= */
const arrows=['left','up','right'];
const icons={left:'â†',up:'â†‘',right:'â†’'};
let flashLvl=1,flashCombo=0,flashTimeLeft=60,flashTimer=null,currentDir='';

function startFlash(){
  show('flashScreen');
  flashLvl=1;flashCombo=0;flashTimeLeft=60;
  updateFlashUI();updateBg(flashLvl);
  if(flashTimer) clearInterval(flashTimer);
  flashTimer=setInterval(()=>{
    flashTimeLeft--;
    document.getElementById('flashTimeDisp').textContent=flashTimeLeft;
    if(flashTimeLeft<=0) endFlash();
  },1000);
  nextFlash();
}

function nextFlash(){
  if(flashTimeLeft<=0) return;
  currentDir=arrows[Math.floor(Math.random()*3)];
  document.getElementById('flashArrow').textContent=icons[currentDir];
}

function answerFlash(a){
  if(flashTimeLeft<=0) return;
  const fb = document.getElementById('feedback');
  if(a===currentDir){
    fb.textContent='ã€‡';fb.style.color='#0f9';flashCombo++;
    if(flashCombo>=10 && flashLvl<7){flashLvl++;flashCombo=0;updateBg(flashLvl);}
  }else{
    fb.textContent='âœ–';fb.style.color='#f00';flashCombo=0;
  }
  updateFlashUI();
  setTimeout(()=>{fb.textContent='';nextFlash();},200);
}

function updateFlashUI(){
  document.getElementById('flashLvDisp').textContent=flashLvl;
  document.getElementById('flashComboDisp').textContent=flashCombo;
}

function endFlash(){
  clearInterval(flashTimer);
  document.getElementById('finalScore').textContent=`ç¬é–“åˆ¤æ–­ ãƒ¬ãƒ™ãƒ«ï¼š${flashLvl} ã‚³ãƒ³ãƒœï¼š${flashCombo}`;
  show('end');
}

/* ===== å…±é€šå‡¦ç† ===== */
function updateBg(lvl){document.body.style.background=bgColors[lvl-1]}
function backTop(){
  document.body.style.background='#111';
  show('top');
}
</script>

</body>
</html>
