<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¬é–“åˆ¤æ–­ å“çƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      background: #111;
      color: #fff;
    }
    #arrow {
      font-size: 120px;
      margin: 30px 0;
    }
    button {
      font-size: 20px;
      padding: 12px 24px;
      margin: 10px;
    }
    #status {
      font-size: 18px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>ğŸ“ ç¬é–“åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>

<div id="arrow">â–¶</div>

<div>
  <button id="leftBtn">â†</button>
  <button id="rightBtn">â†’</button>
</div>

<button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

<div id="status">
  ãƒ¬ãƒ™ãƒ«: <span id="level">1</span> /
  é€£ç¶š: <span id="combo">0</span> /
  ã‚¹ã‚³ã‚¢: <span id="score">1.0</span>
</div>

<script>
/* =====================
   ğŸ”Š BGM å®šç¾©ï¼ˆ1å›ã ã‘ï¼‰
===================== */
const bgmNormal = new Audio("bgm/normal.mp3");
const bgmLevel7 = new Audio("bgm/level7.mp3");

bgmNormal.loop = true;
bgmLevel7.loop = true;
bgmNormal.volume = 0.5;
bgmLevel7.volume = 0.6;

let audioUnlocked = false;

/* =====================
   ã‚²ãƒ¼ãƒ çŠ¶æ…‹
===================== */
let currentArrow = "â†’";
let level = 1;
let combo = 0;
let score = 1.0;
let gameRunning = false;

/* =====================
   è¡¨ç¤ºæ›´æ–°
===================== */
function updateUI() {
  document.getElementById("level").textContent = level;
  document.getElementById("combo").textContent = combo;
  document.getElementById("score").textContent = score.toFixed(1);
}

/* =====================
   BGMåˆ‡ã‚Šæ›¿ãˆ
===================== */
function updateBGM() {
  bgmNormal.pause();
  bgmLevel7.pause();

  if (level === 7) {
    bgmLevel7.currentTime = 0;
    bgmLevel7.play();
  } else {
    bgmNormal.currentTime = 0;
    bgmNormal.play();
  }
}

/* =====================
   å•é¡Œå‡ºé¡Œ
===================== */
function nextQuestion() {
  currentArrow = Math.random() < 0.5 ? "â†" : "â†’";
  document.getElementById("arrow").textContent = currentArrow;
}

/* =====================
   å›ç­”å‡¦ç†
===================== */
function answer(dir) {
  if (!gameRunning) return;

  if (dir === currentArrow) {
    combo++;

    if (level < 7 && combo >= 5) {
      level++;
      combo = 0;
      updateBGM();
    }

    if (level === 7 && combo % 5 === 0) {
      score += 1;
    } else {
      score = level + combo / 10;
    }
  } else {
    combo = 0;
  }

  updateUI();

  setTimeout(nextQuestion, 400);
}

/* =====================
   ã‚¹ã‚¿ãƒ¼ãƒˆå‡¦ç†ï¼ˆéŸ³ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼‰
===================== */
document.getElementById("startBtn").addEventListener("click", () => {
  if (!audioUnlocked) {
    bgmNormal.play().then(() => {
      bgmNormal.pause();
      bgmNormal.currentTime = 0;
      audioUnlocked = true;
    });
  }

  level = 1;
  combo = 0;
  score = 1.0;
  gameRunning = true;

  updateUI();
  updateBGM();
  nextQuestion();
});

/* =====================
   ãƒœã‚¿ãƒ³
===================== */
document.getElementById("leftBtn").onclick = () => answer("â†");
document.getElementById("rightBtn").onclick = () => answer("â†’");

</script>

</body>
</html>
