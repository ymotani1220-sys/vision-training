<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰“ç‚¹åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  transition:background 0.5s;
  touch-action: manipulation;
}
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.hidden{display:none}

#info{margin-top:20px;font-size:20px}
#result{font-size:42px;height:50px;margin:8px}

#gameArea{
  position:relative;
  width:100%;
  max-width:420px;
  flex:1;
  overflow:hidden;
}

#floor{
  position:absolute;
  bottom:120px;
  width:100%;
  height:4px;
  background:#666;
}

#ball{
  position:absolute;
  width:48px;
  height:48px;
  border-radius:50%;
  background:#fff;
  box-shadow:0 0 15px rgba(255,255,255,0.6);
}

button{
  font-size:22px;
  padding:16px 30px;
  margin:12px;
  border:none;
  border-radius:12px;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="top" class="screen">
  <h1 style="margin-top:80px">ğŸ“ æ‰“ç‚¹åˆ¤æ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="game" class="screen hidden">
  <div id="info">
    â± <span id="time">60</span>ã€€
    â­ <span id="score">1.0</span>
  </div>
  <div id="result"></div>
  <div id="gameArea">
    <div id="floor"></div>
    <div id="ball"></div>
  </div>
</div>

<div id="end" class="screen hidden">
  <h2>çµ‚äº†ï¼</h2>
  <p id="finalScore" style="font-size:48px"></p>
  <button onclick="location.reload()">ãƒˆãƒƒãƒ—ã¸</button>
</div>

<script>
/* ===== ãƒ¬ãƒ™ãƒ«è¨­å®šï¼ˆé«˜é€ŸåŒ–å¼·åŒ–ç‰ˆï¼‰ ===== */
function levelParams(lv){
  const g = lv < 3 ? 0.25 : 0.35;
  const vx = 1.2 + Math.pow(lv, 1.35) * 0.9; // â˜…å¼·åŒ–ãƒã‚¤ãƒ³ãƒˆ
  const vy = -5.2 + lv * 0.35;
  const startY = Math.min(0.25 + lv * 0.035, 0.65);
  return {g,vx,vy,startY};
}

const bgColors=[
  '#111','#1a2635','#1a3526',
  '#352a1a','#351a1a','#261a35','#351a35','#4a148c'
];

const RESTITUTION = 0.65;

let level=1, combo=0;
let time=60, timer=null;
let x,y,vx,vy,bounced=0,active=false;
let area, floorY;
const BALL_R = 24;

/* UI */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
function updateBg(){
  document.body.style.background=bgColors[Math.min(level-1,bgColors.length-1)];
}
function updateScore(){
  document.getElementById('score').textContent=`${level}.${combo}`;
}

/* é–‹å§‹ */
function startGame(){
  show('game');
  level=1; combo=0; time=60;
  updateScore(); updateBg();
  document.getElementById('time').textContent=time;

  timer=setInterval(()=>{
    time--;
    document.getElementById('time').textContent=time;
    if(time<=0) endGame();
  },1000);

  spawnBall();
}

/* ãƒœãƒ¼ãƒ«ç”Ÿæˆ */
function spawnBall(){
  const lv = levelParams(level);
  area = document.getElementById('gameArea');

  const areaRect = area.getBoundingClientRect();
  const floorRect = document.getElementById('floor').getBoundingClientRect();

  floorY = floorRect.top - areaRect.top - BALL_R;

  x = 20;
  y = area.clientHeight * lv.startY;
  vx = lv.vx;
  vy = lv.vy;
  bounced = 0;
  active = true;

  const ball = document.getElementById('ball');
  ball.style.left = x + 'px';
  ball.style.top  = y + 'px';

  requestAnimationFrame(updateBall);
}

/* ç‰©ç† */
function updateBall(){
  if(!active) return;
  const lv = levelParams(level);

  vy += lv.g;
  x += vx;
  y += vy;

  if(y >= floorY){
    y = floorY;
    vy *= -RESTITUTION;
    bounced++;
    if(bounced >= 2){
      fail();
      return;
    }
  }

  const ball = document.getElementById('ball');
  ball.style.left = x + 'px';
  ball.style.top  = y + 'px';

  if(x < area.clientWidth + 60){
    requestAnimationFrame(updateBall);
  }
}

/* åˆ¤å®š */
document.getElementById('gameArea').addEventListener('pointerdown',()=>{
  if(active && bounced === 1){
    success();
  }
});

function success(){
  active=false;
  document.getElementById('result').textContent='ã€‡';
  document.getElementById('result').style.color='#0f9';
  combo++;
  if(combo >= 5){
    level++;
    combo = 0;
    updateBg();
  }
  updateScore();
  setTimeout(reset,600);
}

function fail(){
  active=false;
  document.getElementById('result').textContent='âœ–';
  document.getElementById('result').style.color='#f00';
  combo=0;
  updateScore();
  setTimeout(reset,600);
}

function reset(){
  document.getElementById('result').textContent='';
  spawnBall();
}

/* çµ‚äº† */
function endGame(){
  clearInterval(timer);
  show('end');
  document.getElementById('finalScore').textContent=`${level}.${combo}`;
}
</script>

</body>
</html>
