<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>横回転判断トレーニング</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:sans-serif;
  display:flex;
  justify-content:center;
}
#app{
  width:100%;
  max-width:420px;
  height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* ===== 上部情報 ===== */
#topInfo{
  width:100%;
  height:8vh;
  min-height:60px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 18px;
  box-sizing:border-box;
}
#time{ font-size:20px; }
#score{ font-size:24px; font-weight:bold; }

/* ===== 卓球台エリア ===== */
#tableWrapper{
  width:100%;
  height:58vh;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  padding-top:10px;
}
:root{ --court-width:70%; }

#tableArea{
  position:relative;
  width:var(--court-width);
  height:92%;
}

/* ===== 矢印 ===== */
#spinHint{
  position:absolute;
  top:-70px;
  font-size:52px;
  font-weight:900;
  color:#ff2a2a;
  display:none;
  pointer-events:none;
  text-shadow:0 0 8px rgba(255,0,0,0.8);
}

/* ===== 卓球台 ===== */
#table{
  position:relative;
  width:100%;
  height:100%;
  background:#0bbf63;
  border:6px solid #fff;
  box-sizing:border-box;
}
#net{
  position:absolute;
  top:50%;
  left:0;
  width:100%;
  height:6px;
  background:#fff;
  transform:translateY(-50%);
}
#centerLine{
  position:absolute;
  top:0;
  left:50%;
  width:6px;
  height:100%;
  background:#fff;
  transform:translateX(-50%);
}

/* ===== ボール ===== */
#ball{
  position:absolute;
  width:28px;
  height:28px;
  border-radius:50%;
  background:orange;
  display:none;
}

/* ===== 判定ボタン ===== */
#controls{
  width:100%;
  height:30vh;
  display:flex;
  justify-content:center;
  padding-bottom:env(safe-area-inset-bottom);
}
#buttonGrid{
  width:var(--court-width);
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-template-rows:repeat(3,56px);
  row-gap:6px;
}
.spinBtn{
  position:relative;
  width:90px;
  height:44px;
  border-radius:50px;
  background:#5de0e6;
  justify-self:center;
  display:flex;
  justify-content:center;
  align-items:center;
}
.spinBtn.correct{
  background:#2ecc71;
  box-shadow:0 0 12px #2ecc71;
}
.spinBtn.wrong{
  background:#e74c3c;
  box-shadow:0 0 12px #e74c3c;
}

/* ラケット角度線 */
.blade{
  position:absolute;
  width:36px;
  height:4px;
  background:#003344;
  border-radius:2px;
}
.blade.left{ transform:rotate(-25deg); }
.blade.center{ transform:rotate(0deg); }
.blade.right{ transform:rotate(25deg); }
</style>
</head>

<body>
<div id="app">

  <div id="topInfo">
    <div id="time">⏱ 60</div>
    <div id="score">スコア 1.0</div>
  </div>

  <div id="tableWrapper">
    <div id="tableArea">
      <div id="spinHint">↘</div>
      <div id="table">
        <div id="net"></div>
        <div id="centerLine"></div>
        <div id="ball"></div>
      </div>
    </div>
  </div>

  <div id="controls">
    <div id="buttonGrid">
      <!-- フォア -->
      <div class="spinBtn" data-course="0" data-spin="0"><span class="blade left"></span></div>
      <div class="spinBtn" data-course="0" data-spin="1"><span class="blade center"></span></div>
      <div class="spinBtn" data-course="0" data-spin="2"><span class="blade right"></span></div>
      <!-- ミドル -->
      <div class="spinBtn" data-course="1" data-spin="0"><span class="blade left"></span></div>
      <div class="spinBtn" data-course="1" data-spin="1"><span class="blade center"></span></div>
      <div class="spinBtn" data-course="1" data-spin="2"><span class="blade right"></span></div>
      <!-- バック -->
      <div class="spinBtn" data-course="2" data-spin="0"><span class="blade left"></span></div>
      <div class="spinBtn" data-course="2" data-spin="1"><span class="blade center"></span></div>
      <div class="spinBtn" data-course="2" data-spin="2"><span class="blade right"></span></div>
    </div>
  </div>

</div>

<script>
const ball = document.getElementById('ball');
const hint = document.getElementById('spinHint');
const table = document.getElementById('table');

let correctSpin = 0;    // 0:left 1:center 2:right
let correctCourse = 0; // 0:fore 1:middle 2:back
let judging = false;

/* 発射位置（コーナー寄り） */
const launchRatios = [
  0.18, // フォア
  0.50, // ミドル
  0.82  // バック
];

/* 回転表示 */
const spins = ['↙','↓','↘'];

function launchBall(){
  if(judging) return;
  judging = true;

  const rect = table.getBoundingClientRect();

  correctCourse = Math.floor(Math.random()*3);
  correctSpin = Math.floor(Math.random()*3);

  const xRatio = launchRatios[correctCourse];
  const spin = spins[correctSpin];

  const x = rect.width * xRatio;
  const y = rect.height * 0.08;

  ball.style.left = (x - 14) + 'px';
  ball.style.top = (y - 14) + 'px';
  ball.style.display = 'block';

  hint.textContent = spin;
  hint.style.left = (x - 26) + 'px';
  hint.style.display = 'block';

  setTimeout(()=>{ hint.style.display = 'none'; }, 350);
}

/* 判定 */
document.querySelectorAll('.spinBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    if(!judging) return;

    const c = Number(btn.dataset.course);
    const s = Number(btn.dataset.spin);

    if(c === correctCourse && s === correctSpin){
      btn.classList.add('correct');
    }else{
      btn.classList.add('wrong');
    }

    judging = false;

    setTimeout(()=>{
      document.querySelectorAll('.spinBtn').forEach(b=>{
        b.classList.remove('correct','wrong');
      });
      ball.style.display = 'none';
      launchBall();
    }, 600);
  });
});

/* テスト用自動発射 */
launchBall();
</script>

</body>
</html>
