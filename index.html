<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>横回転判断ゲーム（単体版）</title>

<style>
body{
  margin:0;
  background:#1b5e20;
  font-family:sans-serif;
  color:#fff;
  display:flex;
  justify-content:center;
}

#game{
  width:360px;
  height:640px;
  position:relative;
  background:#2e7d32;
  overflow:hidden;
}

/* ===== 上部情報 ===== */
#top{
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
  font-size:16px;
}

/* ===== 卓球台 ===== */
#table-wrap{
  position:relative;
  width:100%;
  height:420px;
}

#table{
  position:absolute;
  left:50%;
  top:40px;
  transform:translateX(-50%);
  width:240px;
  height:360px;
  background:#1565c0;
  border:4px solid #fff;
  box-sizing:border-box;
}

/* ライン */
#line-center{
  position:absolute;
  left:50%;
  top:0;
  width:2px;
  height:100%;
  background:#fff;
  transform:translateX(-50%);
}

#net{
  position:absolute;
  left:0;
  top:50%;
  width:100%;
  height:4px;
  background:#fff;
}

/* ===== ボール ===== */
#ball{
  position:absolute;
  width:24px;
  height:24px;
  border-radius:50%;
  background:#fff;
  display:none;
}

/* ===== 回転矢印 ===== */
.spin-arrow{
  position:absolute;
  font-size:42px;
  font-weight:bold;
  color:#ffeb3b;
}

/* ===== ボタン ===== */
#buttons{
  position:absolute;
  bottom:10px;
  width:100%;
  display:flex;
  justify-content:space-around;
}

.col{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.btn{
  width:64px;
  height:36px;
  background:#eee;
  border-radius:50%;
  position:relative;
}

.btn::after{
  content:"";
  position:absolute;
  width:40px;
  height:2px;
  background:#000;
  top:50%;
  left:50%;
  transform-origin:center;
}

/* ラケット角度 */
.left::after{ transform:translate(-50%,-50%) rotate(-30deg); }
.straight::after{ transform:translate(-50%,-50%) rotate(0deg); }
.right::after{ transform:translate(-50%,-50%) rotate(30deg); }
</style>
</head>

<body>
<div id="game">

  <div id="top">
    <div>TIME 30</div>
    <div>SCORE 0</div>
  </div>

  <div id="table-wrap">
    <div id="table">
      <div id="line-center"></div>
      <div id="net"></div>
    </div>

    <div id="ball"></div>
  </div>

  <div id="buttons">
    <!-- 左列 -->
    <div class="col">
      <div class="btn left" data-angle="left"></div>
      <div class="btn straight" data-angle="straight"></div>
      <div class="btn right" data-angle="right"></div>
    </div>

    <!-- 中央列 -->
    <div class="col">
      <div class="btn left" data-angle="left"></div>
      <div class="btn straight" data-angle="straight"></div>
      <div class="btn right" data-angle="right"></div>
    </div>

    <!-- 右列 -->
    <div class="col">
      <div class="btn left" data-angle="left"></div>
      <div class="btn straight" data-angle="straight"></div>
      <div class="btn right" data-angle="right"></div>
    </div>
  </div>

</div>

<script>
const ball = document.getElementById("ball");
const table = document.getElementById("table");
const game = document.getElementById("game");

/*
spin（プレイヤー目線）
0 = 反時計回り ⟲ → 右に曲がる
1 = 回転なし
2 = 時計回り ⟳ → 左に曲がる
*/

const serveX = [
  table.offsetLeft + 20,
  table.offsetLeft + table.offsetWidth/2 - 12,
  table.offsetLeft + table.offsetWidth - 44
];

function calcArrivalCourse(start, spin){
  if(spin===0) return Math.min(2,start+1);
  if(spin===2) return Math.max(0,start-1);
  return start;
}

function showArrow(x, y, spin){
  if(spin===1) return;
  const a=document.createElement("div");
  a.className="spin-arrow";
  a.textContent= spin===0 ? "⟲" : "⟳";
  a.style.left = x-8+"px";
  a.style.top = y-44+"px";
  game.appendChild(a);
  setTimeout(()=>a.remove(),900);
}

function serve(){
  const start = Math.floor(Math.random()*3);
  const spin = Math.floor(Math.random()*3);
  const arrival = calcArrivalCourse(start,spin);

  const startX = serveX[start];
  const endX = serveX[arrival];

  let y = table.offsetTop + 10;
  let x = startX;
  ball.style.display="block";

  showArrow(x,y,spin);

  const curve = [2,0,-2][spin];

  const timer = setInterval(()=>{
    y += 2;
    x += curve;
    ball.style.left=x+"px";
    ball.style.top=y+"px";

    if(y > table.offsetTop + table.offsetHeight - 30){
      clearInterval(timer);
      ball.style.display="none";
      setTimeout(serve,800);
    }
  },30);
}

serve();
</script>
</body>
</html>
